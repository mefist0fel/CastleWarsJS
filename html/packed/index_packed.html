<html>
	<head>
		<title>Castles</title>
		<style type="text/css">
		body {
			display: block;
			background-color:0;
			width: 100%;
			height: 100%;
			margin: 0;
		}
		canvas {
			background-color:0;
			display: block;
			margin: 0px auto;
		}
		</style>
	</head>
	<body>
		<canvas id="a"></canvas>
	</body>
	<script type="text/javascript">


const aa=Number.MAX_VALUE,ba=Number.MIN_VALUE,da=Math.PI,ea=Math.cos,fa=Math.sin,ha=Math.min,ia=Math.max,ja=Math.round,ka=Math.random,la=Math.floor;function n(a){return ia(ha(a,1),0)}function ma(a,b){return[a[0]-b[0],a[1]-b[1]]}function sa(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function ta(a){var b=1/sa(a);Infinity==b&&(b=aa);-Infinity==b&&(b=ba);return[a[0]*b,a[1]*b]}function t(a=0,b=0,d=0){return[a,b,d]}function v(a,b){return[a[0]+b[0],a[1]+b[1],a[2]+b[2]]}
function w(a,b){return[a[0]*b,a[1]*b,a[2]*b]}function ua(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2])};function va(a,b){wa.addEventListener(a,b,!1)};function za(){this.L=function(a){for(var b=0;24>b;b++)this[String.fromCharCode(97+b)]=a[b]||0;.01>this.c&&(this.c=.01);a=this.b+this.c+this.e;.18>a&&(a=.18/a,this.b*=a,this.c*=a,this.e*=a)}}
var Aa=new function(){this.L=new za;var a,b,d,c,h,g,p,m,u,x,q,f;this.ia=function(){var e=this.L;c=100/(e.f*e.f+.001);h=100/(e.g*e.g+.001);g=1-e.h*e.h*e.h*.01;p=-e.i*e.i*e.i*1E-6;e.a||(q=.5-e.n/2,f=5E-5*-e.o);m=1+e.l*e.l*(0<e.l?-.9:10);u=0;x=1==e.m?0:(1-e.m)*(1-e.m)*2E4+32};this.qa=function(){this.ia();var e=this.L;a=e.b*e.b*1E5;b=e.c*e.c*1E5;d=e.e*e.e*1E5+12;return 3*((a+b+d)/3|0)};this.pa=function(e,k){var l=this.L,y=1!=l.s||l.v,F=l.v*l.v*.1,N=1+3E-4*l.w,W=l.s*l.s*l.s*.1,Ib=1+1E-4*l.t,Jb=1!=l.s,
Kb=l.x*l.x,Lb=l.g,bb=l.q||l.r,Mb=l.r*l.r*l.r*.2,cb=l.q*l.q*(0>l.q?-1020:1020),db=l.p?((1-l.p)*(1-l.p)*2E4|0)+32:0,Nb=l.d,eb=l.j/2,Ob=l.k*l.k*.01,Ia=l.a,Ja=a,Pb=1/a,Qb=1/b,Rb=1/d;l=5/(1+l.u*l.u*20)*(.01+W);.8<l&&(l=.8);l=1-l;for(var Ka=!1,fb=0,na=0,oa=0,gb=0,xa=0,pa,qa=0,I,X=0,Y,La=0,r,hb=0,ca,ib=0,ya=Array(1024),ra=Array(32),K=ya.length;K--;)ya[K]=0;for(K=ra.length;K--;)ra[K]=2*Math.random()-1;for(K=0;K<k;K++){if(Ka)return K;db&&++hb>=db&&(hb=0,this.ia());x&&++u>=x&&(x=0,c*=m);g+=p;c*=g;c>h&&(c=h,
0<Lb&&(Ka=!0));I=c;0<eb&&(ib+=Ob,I*=1+Math.sin(ib)*eb);I|=0;8>I&&(I=8);Ia||(q+=f,0>q?q=0:.5<q&&(q=.5));if(++na>Ja)switch(na=0,++fb){case 1:Ja=b;break;case 2:Ja=d}switch(fb){case 0:oa=na*Pb;break;case 1:oa=1+2*(1-na*Qb)*Nb;break;case 2:oa=1-na*Rb;break;case 3:oa=0,Ka=!0}bb&&(cb+=Mb,Y=cb|0,0>Y?Y=-Y:1023<Y&&(Y=1023));y&&N&&(F*=N,1E-5>F?F=1E-5:.1<F&&(F=.1));ca=0;for(var Sb=8;Sb--;){X++;if(X>=I&&(X%=I,3==Ia))for(pa=ra.length;pa--;)ra[pa]=2*Math.random()-1;switch(Ia){case 0:r=X/I<q?.5:-.5;break;case 1:r=
1-X/I*2;break;case 2:r=X/I;r=6.28318531*(.5<r?r-1:r);r=1.27323954*r+.405284735*r*r*(0>r?1:-1);r=.225*((0>r?-1:1)*r*r-r)+r;break;case 3:r=ra[Math.abs(32*X/I|0)]}y&&(pa=qa,W*=Ib,0>W?W=0:.1<W&&(W=.1),Jb?(xa+=(r-qa)*W,xa*=l):(qa=r,xa=0),qa+=xa,gb+=qa-pa,r=gb*=1-F);bb&&(ya[La%1024]=r,r+=ya[(La-Y+1024)%1024],La++);ca+=r}ca*=.125*oa*Kb;e[K]=1<=ca?32767:-1>=ca?-32768:32767*ca|0}return k}};
window.jsfxr=function(a){Aa.L.L(a);var b=Aa.qa();a=new Uint8Array(4*((b+1)/2|0)+44);b=2*Aa.pa(new Uint16Array(a.buffer,44),b);var d=new Uint32Array(a.buffer,0,44);d[0]=1179011410;d[1]=b+36;d[2]=1163280727;d[3]=544501094;d[4]=16;d[5]=65537;d[6]=44100;d[7]=88200;d[8]=1048578;d[9]=1635017060;d[10]=b;b+=44;d=0;for(var c="data:audio/wav;base64,";d<b;d+=3){var h=a[d]<<16|a[d+1]<<8|a[d+2];c+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[h>>18]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[h>>
12&63]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[h>>6&63]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[h&63]}return c};var z=[],Ba=t(1,0,0),Ca=t(0,1,0),Da=t(0,0,1),Ea=t(0,0,-20),Fa=t(),Ga=null,Ha=1.6,Ma=1;function Na(){var a=Oa;let b=a/180*da;a=(a/180+.5)*da;Ba=t(ea(b),.6*fa(b),fa(b));Ca=t(ea(a),.6*fa(a),fa(a));Da=t(0,-.6,2)}function Pa(a,b){return a.depth<b.depth?1:a.depth>b.depth?-1:0}function Qa(a){a=v(a,w(Fa,-1));a=v(v(w(Ba,a[0]),w(Ca,a[1])),w(Da,a[2]));a=v(a,Ea);a=w(a,Ha*Ma*(1+1E-4*a[2]));return v(a,Ga)}
function Ra(a,b,d,c,h=t(1,1,1),g=0){var p={ga:[a,b,d,c],depth:0,color:h,enable:!0,Y(m,u,x,q,f=null){this.points=[m,u,x,q];if(null==f){m=p.points;u=t();for(x=0;x<m.length;x++)u=v(u,m[x]);m=w(u,1/parseFloat(m.length))}else m=f;this.position=m;this.position[2]=0},setColor(m){p.color=m},fa(){if(p.enable){p.depth=-Qa(p.position)[2]+g;for(let m=0;m<p.ga.length;m++)p.ga[m]=Qa(p.points[m])}},aa(){p.enable&&(A.fillStyle=Sa(p.color),Ta(p.ga))}};p.Y(a,b,d,c);z.push(p);return p}
function Ta(a){var b=a[0],d=ma(a[1],b);d=ta([d[1],-d[0]]);b=ma(b,a[2]);if(!(0<d[0]*b[0]+d[1]*b[1])){A.beginPath();b=a[3];A.moveTo(b[0],b[1]);for(b=0;4>b;b++)A.lineTo(a[b][0],a[b][1]);A.closePath();A.fill()}}function Sa(a){let b=ja(255*n(a[0])),d=ja(255*n(a[1]));a=ja(255*n(a[2]));return Ua(b,d,a)}function Ua(a,b,d){function c(h){h=h.toString(16);return 1==h.length?"0"+h:h}return"#"+c(a)+c(b)+c(d)+c(255)};let Va=1,Wa=[];for(var B=0;1E4>B;B++)Va=16807*Va%2147483647,Wa.push(ka(Va/2147483647));function C(a,b,d,c=1E3){a=a*d+c;c=b*d+1E3;b=la(a);d=la(c);a-=b;c-=d;return(Wa[b%100*100+d%100]*(1-a)+Wa[(b+1)%100*100+d%100]*a)*(1-c)+(Wa[b%100*100+(d+1)%100]*(1-a)+Wa[(b+1)%100*100+(d+1)%100]*a)*c};let D=Array,Xa=[];const Ya=[t(-1,1),t(-1,-1),t(1,1),t(1,-1)];
function Za(a,b,d=-1,c=0){function h(f,e,k,l,y=null){e=g(e,k,l);return 0<=e&&e<f.length?f[e]:y}function g(f,e,k=1,l=1){return f*k+e*l}function p(f,e,k){f>e?(f-=k,f<e&&(f=e)):(f+=k,f>e&&(f=e));return f}let m=4*a;d={G:D(a*a),K:D(a*a),points:D(a*a*4),F:D(a*a),H:D(a*a),Z:D(a*a),T:D(a*a),S:D(a*a),size:a,threshold:d,ha(f,e,k){var l=this.K;f=g(f,e,this.size);0<=f&&f<l.length&&(l[f]=k)},ua(f,e){return h(this.K,f,e,this.size,0)},setColor(f,e,k){var l=this.H;f=g(f,e,this.size);0<=f&&f<l.length&&(l[f]=k)},ta(f,
e){return h(this.H,f,e,this.size,t())},update(f){let e=!1;for(var k=0;k<this.K.length;k++)this.G[k]!=this.K[k]&&(this.G[k]=p(this.G[k],this.K[k],50*f),e=!0);for(k=0;k<this.H.length;k++)if(this.F[k][0]!=this.H[k][0]||this.F[k][1]!=this.H[k][1]||this.F[k][2]!=this.H[k][2])e=!0,this.F[k][0]=p(this.F[k][0],this.H[k][0],2*f),this.F[k][1]=p(this.F[k][1],this.H[k][1],2*f),this.F[k][2]=p(this.F[k][2],this.H[k][2],2*f);e&&this.I()},I(){for(var f=0;f<this.size;f++)for(var e=0;e<this.size;e++){var k=g(f,e,this.size);
k=t((f-u)*b,(e-u)*b,this.G[k]);for(var l=0;4>l;l++){var y=g(2*f+Math.floor(l/2),2*e+l%2,m);this.points[y]=v(k,w(Ya[l],x))}}for(f=0;f<this.size;f++)for(e=0;e<this.size;e++)k=g(f,e,this.size),this.Z[k].Y(this.points[g(2*f,2*e,m)],this.points[g(2*f+1,2*e,m)],this.points[g(2*f+1,2*e+1,m)],this.points[g(2*f,2*e+1,m)]),this.Z[k].setColor(this.F[k]),this.Z[k].enable=this.G[k]>=this.threshold,f<this.size-1&&(this.T[k].Y(this.points[g(2*f+1,2*e,m)],this.points[g(2*f+2,2*e,m)],this.points[g(2*f+2,2*e+1,m)],
this.points[g(2*f+1,2*e+1,m)]),l=g(f+1,e,this.size),this.G[k]>this.G[l]?(y=w(this.F[k],.8),this.T[k].enable=this.G[k]>=this.threshold):(y=w(this.F[l],.8),this.T[k].enable=this.G[l]>=this.threshold),this.T[k].setColor(y)),e<this.size-1&&(this.S[k].Y(this.points[g(2*f+1,2*e,m)],this.points[g(2*f,2*e,m)],this.points[g(2*f,2*e+3,m)],this.points[g(2*f+1,2*e+3,m)]),l=g(f,e+1,this.size),this.G[k]>this.G[l]?(y=w(this.F[k],.7),this.S[k].enable=this.G[k]>=this.threshold):(y=w(this.F[l],.7),this.S[k].enable=
this.G[l]>=this.threshold),this.S[k].setColor(y))},clear(f=0){for(var e=0;e<this.size;e++)for(var k=0;k<this.size;k++){let l=g(e,k,this.size);this.K[l]=f}this.I()}};let u=.5*(a-1),x=.5*b;for(a=0;a<d.size;a++)for(var q=0;q<d.size;q++){let f=g(a,q,d.size);d.G[f]=d.threshold;d.K[f]=d.threshold;let e=t(1,1,1);d.Z[f]=Ra(e,e,e,e,e,c);d.T[f]=Ra(e,e,e,e,e,c);d.S[f]=Ra(e,e,e,e,e,c);d.H[f]=e;d.F[f]=t(0,0,0)}d.I();Xa.push(d);return d}
function $a(a){let b=n(.3+.1*a),d=n(.5+.5*a);a=n(.3+.1*a);return t(b,d,a)}function E(a,b,d){for(var c=ab,h=0;5>h;h++)for(var g=0;5>g;g++)c.ha(a+h,b+g,6*d[5*h+g])}function jb(a,b,d,c){for(var h=ab,g=0;g<d;g++)for(var p=0;p<d;p++)h.setColor(a+g,b+p,c)}var ab=Za(85,10,0,-50),kb=Za(35,50,-100);function lb(a,b){for(var d=0;35>d;d++)for(var c=0;35>c;c++){let h=a(d,c),g=n(ua(t(d-17,c-17))/17*2.4-1);h*=g;0<d&&0<c&&34>d&&34>c||(h=-100.01);kb.ha(d,c,h);kb.setColor(d,c,b(d,c))}}
function G(a,b){return n(ua(t(a-17,b-17))/17*2.4-1)}kb.I();
function mb(a){for(B=0;B<nb.length;B++)H(J,nb[B]),H(z,nb[B]);nb=[];for(B=0;B<L.length;B++)H(J,L[B]),H(z,L[B]);L=[];ab.clear(-1E-5);ob.enable=!0;switch(a){case -1:a=[7,6,7,6,7,6,6,6,6,6,7,6,2,6,7,6,6,6,6,6,7,6,7,6,7];var b=[-1E-4,4,3,4,-1E-4,-1E-4,3,3,3,-1E-4,-1E-4,4,3,4,-1E-4,-1E-4,3,3,3,-1E-4,-1E-4,4,3,4,-1E-4];const d=[-1E-4,-1E-4,-1E-4,-1E-4,-1E-4,4,3,4,3,4,3,3,3,3,3,4,3,4,3,4,-1E-4,-1E-4,-1E-4,-1E-4,-1E-4];E(33,33,a);E(33,47,a);E(47,47,a);E(47,33,a);E(40,40,[15,12,15,12,15,12,12,12,12,12,15,12,
12,12,15,12,12,12,12,12,15,12,15,12,15]);E(38,33,b);E(42,33,b);E(38,47,b);E(42,47,b);E(33,38,d);E(33,42,d);E(47,38,d);E(47,42,d);jb(30,30,25,pb(0));lb((c,h)=>80*C(c,h,.3)*G(c,h),(c,h)=>$a(C(c,h,.3)*G(c,h)));break;case 0:M(3,3,0,1);M(-3,-3,1,1);M(1,-1);M(-1,1);qb();ob.enable=!1;lb((c,h)=>80*C(c,h,.3,300)*G(c,h),(c,h)=>$a(C(c,h,.3,300)*G(c,h)));break;default:case 1:M(0,6,0,2);M(0,-6,1,2);for(a=-1;2>a;a++)for(b=-1;2>b;b++)M(3*a,3*b);qb();lb((c,h)=>80*C(c,h,.45)*G(c,h),(c,h)=>{var g=C(c,h,.45)*G(c,h);
c=n(.5+.5*g);h=n(.5+.5*g);g=n(.3+.1*g);return t(c,h,g)});break;case 2:M(3,3,0,1),M(-3,-3,1,1),M(0,0),M(-3,0),M(3,0),M(0,-3),M(0,3),qb(),lb((c,h)=>80*C(c,h,.35,300)*G(c,h),(c,h)=>{var g=C(c,h,.35,300)*G(c,h);c=n(.5+.9*g);h=n(.5+.9*g);g=n(.7+1.5*g);return t(c,h,g)})}};var L=[],O=null;
function M(a,b,d=-1,c=0){const h=[1,2,3],g=[15,20,999],p=[50,80,100],m=t(1,1,1),u=t(.5,.5,.5),x=[[-1E-4,-1E-4,-1E-4,-1E-4,-1E-4,-1E-4,4,2,4,-1E-4,-1E-4,2,0,2,-1E-4,-1E-4,4,2,4,-1E-4,-1E-4,-1E-4,-1E-4,-1E-4,-1E-4],[-1E-4,4,2,4,-1E-4,4,2,2,2,4,2,2,5,2,2,4,2,2,2,4,-1E-4,4,2,4,-1E-4],[4,2,3,2,4,2,7,5,7,2,3,5,3,5,3,2,7,5,7,2,4,2,3,2,4]];var q={A:[a,b],position:t(50*a,50*b),C:t(),N:t(),M:[10,10],D:d,U:0,la:null,target:null,level:c,B:10,X:1,R:0,ka:[],O:0,depth:0,J:null,fa(){this.C=Qa(this.position);this.N=
Qa(v(this.position,t(0,0,64)));let f=Math.abs(this.N[1]-this.C[1]);this.M=[1.2*f,f];this.depth=-this.C[2]-1E3},aa(){A.fillStyle=Sa(pb(q.D));A.fillText(q.B,q.N[0],q.N[1]);q.B>=g[q.level]&&A.fillText("^",q.N[0]+.5*this.M[0],q.N[1])},upgrade(){this.B>=g[q.level]&&(this.B-=g[q.level],this.level+=1,this.I())},update(f){this.X-=f;0>=this.X&&(this.X=1,0<=this.D&&q.B<p[q.level]&&(this.B+=h[this.level]));if(0<this.R)this.R-=f;else if(0<this.B&&0<this.U){for(f=3;0<f&&0<this.U&&0<this.B;)--this.B,--this.U,rb(this.A[0],
this.A[1],this.D,this.la,f-2),--f;this.R+=.3}else this.target=null},contains(f,e){return this.C[0]-this.M[0]<f&&this.C[1]-this.M[1]<e&&this.C[0]+this.M[0]>f&&this.C[1]+this.M[1]>e},attack(f){this.D==f?this.B+=1:0>=this.B?(this.D=f,this.I(),this.B=1):--this.B},na(f){if(null!=f&&null!=f.J){this.target=f;this.U=this.B/2;var e=[];for(e.push(f);null!=f.J;)f=f.J,e.push(f);this.la=e}},I(){E(40+5*this.A[0],40+5*this.A[1],x[this.level]);jb(40+5*this.A[0],40+5*this.A[1],5,pb(this.D));ab.I()},sa(f){var e=-1E-5,
k=u;null!=this.J&&(e=0,k=u);f&&(e=0,k=m);f=39+5*this.A[0];for(var l=39+5*this.A[1],y=ab,F=0;7>F;F++)for(var N=0;7>N;N++)if(0==F||0==N||6==F||6==N)y.ha(f+F,l+N,e),y.setColor(f+F,l+N,k)},va(){H(J,q);H(z,q);H(L,q)}};J.push(q);z.push(q);L.push(q);q.I()}function sb(){L.forEach(a=>a.sa(a==O));ab.I()}function pb(a){switch(a){case 0:return t(.2,.2,1);case 1:return t(1,.2,.2);case 2:return t(.2,1,.2);default:return t(.6,.6,.6)}}
function tb(){var a=P.W;let b=a[0];a=a[1];for(var d=0;d<L.length;d++)if(L[d].contains(b,a))return L[d];return null}function qb(){for(var a=0;a<L.length;a++)for(var b=0;b<L.length;b++)a!=b&&6>sa(ma(L[a].A,L[b].A))&&L[a].ka.push(L[b])}function ub(a){L.forEach(d=>{d.O=99999;d.J=null});if(null!=a){var b=[];b.push(a);for(a.O=0;0<b.length;){let d=b.pop();d.ka.forEach(c=>{let h=d.O+sa(ma(d.A,c.A));c.O>h&&(c.O=h,c.J=d,c.D==a.D&&b.push(c))})}}};const vb=[0,0];var nb=[];
function rb(a,b,d,c,h=0){var g={offset:h,ea:[0,0],A:[a,b],position:t(50*a,50*b),C:t(),ma:t(),oa:vb,P:0,ba:d,target:null,path:[...c],B:1,fa(){this.C=Qa(this.position);this.ma=Qa(v(this.position,t(0,0,5)));this.depth=-this.C[2]-500},aa(){var p=Math.abs(this.C[2]-this.ma[2]),m=.2*p,u=.34*p;let x=[v(this.C,t(0,m)),v(this.C,t(u,0)),v(this.C,t(u,-p)),v(this.C,t(0,-p))];p=[v(this.C,t(0,m)),v(this.C,t(0,-p)),v(this.C,t(-u,-p)),v(this.C,t(-u,0))];A.fillStyle=Sa(w(pb(g.ba),.95));Ta(x);A.fillStyle=Sa(w(pb(g.ba),
.85));Ta(p)},update(p){var m=g.oa;m=[m[0]*p,m[1]*p];var u=g.A;g.A=[u[0]+m[0],u[1]+m[1]];g.position=[50*(g.A[0]+g.ea[0]*g.offset*.2),50*(g.A[1]+g.ea[1]*g.offset*.2),2*fa(30*this.P+this.offset)];g.P-=p;0>=g.P&&(0<g.path.length?(g.target=g.path.pop(),m=ma(g.target.A,g.A),p=ta(m),g.ea=[-p[1],p[0]],m=sa(m),g.oa=[1*p[0],1*p[1]],g.P=m/1):(g.target.attack(g.ba),H(J,g),H(z,g),H(nb,g)))}};J.push(g);z.push(g);nb.push(g)}function H(a,b){b=a.indexOf(b);-1<b&&a.splice(b,1)};var wb,xb=0,zb=yb(),Ab=1/30,wa=document,Bb=wa.getElementById("a"),A=Bb.getContext("2d"),Q=1,R=1,Cb=1,Db=1,Eb=1,S=1,Fb=wa.documentElement,Gb=0,Oa=0,J=[];Hb();
var P=function(a){for(var b={key:[200],V:!1,da:!1,ca:!1,ra:!1,W:[0,0],update(){this.da=this.V=!1}},d=0;200>d;d++)b.key[d]=!1;va("keydown",function(c){b.key[c.keyCode]=!0});va("keyup",function(c){b.key[c.keyCode]=!1});va("click",function(){});va("mousedown",function(c){0==c.button&&(b.V=!0,b.ca=!0);2==c.button&&(b.da=!0,b.ca=!0)});va("mouseup",function(c){0==c.button&&(b.ca=!1);2==c.button&&(b.ra=!1)});va("mousemove",function(c){b.W[0]=c.clientX-a.left;b.W[1]=c.clientY-a.top});return b}(Bb.getBoundingClientRect()),
ob=function(a=1,b=1){a={enable:!0,D:a,$:.5,threshold:20,update(d){this.enable&&(this.$-=d,0>this.$&&(this.$=.5+ka()*b,L.forEach(c=>{c.D==this.D&&(c.B>this.threshold&&(3<c.level&&this.ja(c),.3>ka()?c.upgrade():this.ja(c)),this.threshold=20+ka(15))})))},ja(d){ub(d);let c=[];L.forEach(h=>{h!=d&&null!=h.J&&h.D!=this.D&&c.push(h)});0==c.length&&L.forEach(h=>{h!=d&&null!=h.J&&h.D==this.D&&c.push(h)});0<c.length&&d.na(c[Math.floor(ka()*c.length)])}};J.push(a);return a}(),T=0,Tb=null;Ha=.7;U(0);V();
function Ub(){A.fillStyle="#101010";A.fillRect(0,0,Q,R);for(var a=0;a<z.length;a++)z[a].fa();z.sort(Pa);for(a=0;a<z.length;a++)z[a].aa()}function U(a){0==a?(mb(-1),Tb=Vb):-1==a?(mb(T),Tb=Wb):-2==a?Tb=Xb:-3==a?Tb=Yb:1==a&&(Tb=Zb)}function $b(a){Ha=.02*a+.98*Ha}function ac(a){Oa+=8*a;360<Oa&&(Oa-=360);Na()}function bc(a){Gb+=.1*a;Oa=.9*Oa+.1*(10*fa(Gb)+65);Na()}
function Xb(a){$b(1.2);ac(a);Xa.forEach(b=>b.update(a));Ub();A.fillStyle="#66FF66";V(60);cc("WIN",-35);V();Z("MENU",0,0,18)&&U(0);Z("NEXT",0,20,18)&&(T+=1,U(-1));P.key[27]&&U(0)}function Yb(a){$b(1.2);ac(a);Xa.forEach(b=>b.update(a));Ub();A.fillStyle="#FF6666";V(60);cc("LOSE",-35);V();Z("MENU",0,0,18)&&U(0);Z("RESTART",0,20,18)&&U(-1);P.key[27]&&U(0)}
function Vb(a){$b(1.2);ac(a);Xa.forEach(b=>b.update(a));Ub();A.fillStyle="#FFFFFF";V(60);cc("CASTLE WARS",-35);V();Z("START",0,20,18)&&U(-1);P.key[32]&&U(-1)}function Wb(a){$b(1.4);Xa.forEach(b=>b.update(a));bc(a);Ub();A.fillStyle="#FFFFFF";V(40);cc("SELECT LEVEL",-35);V(32);0<T?cc(T,-25):cc("TUTORIAL",-25);V();Z("START",0,20,18)&&U(1);P.key[32]&&U(1);P.key[27]&&U(0);if(Z(">>",16,20,9)||P.key[39])T+=1,mb(T);if(0<T&&Z("<<",-16,20,9)||P.key[37])--T,mb(T)}
function Zb(a){$b(1.6);Xa.forEach(c=>c.update(a));P.key[27]&&U(0);P.V&&(O=tb(),null!=O&&0!=O.D&&(O=null),ub(O),sb());if(P.da){let c=tb();null!=O&&null!=c&&(O==c?O.upgrade():(ub(O),O.na(c)))}let b=0,d=0;L.forEach(c=>{0==c.D&&(b+=1);1==c.D&&(d+=1)});0==b&&U(-3);0==d&&U(-2);J.forEach(c=>c.update(a));bc(a);Ub()}function yb(){let a=window.performance;return a&&a.now?a.now():(new Date).getTime()}let dc=requestAnimationFrame;
function ec(){wb=yb();xb=Math.min(1,(wb-zb)/1E3);xb>Ab&&(xb=Ab);zb=wb;Tb(xb);dc(ec);P.update();Q==Fb.clientWidth&&R==Fb.clientHeight||Hb()}dc(ec);function Hb(){Q=Fb.clientWidth;R=Fb.clientHeight;Cb=Math.min(Q,R);Db=.5*Q;Eb=.5*R;S=.01*Cb;Bb.width=Q;Bb.height=R;var a=Q,b=R;Ga=t(.5*a,.5*b);Ma=Math.min(a,b)/1024}function V(a=24){R>Q&&(a*=R/Q);A.font=parseInt(a)+"pt Arial";A.textAlign="center"}function cc(a,b){A.fillText(a,0*S+Db,b*S+Eb)}
function Z(a,b,d,c){c=c*S*.5;let h=3*S;b=b*S+Db;d=d*S+Eb;A.fillStyle="#66666699";A.fillRect(b-c,d-h-12,2*c,2*h);A.fillStyle="#FFFFFF";A.fillText(a,b,d);return P.V&&(a=P.W,b-c<a[0]&&d-h<a[1]&&b+c>a[0]&&d+h>a[1])?(P.update(1),!0):!1};


</script>
</html>