<html>
	<head>
		<title>Castles</title>
		<style type="text/css">
		body {
			display: block;
			background-color:0;
			width: 100%;
			height: 100%;
			margin: 0;
		}
		canvas {
			background-color:#ffffff;
			display: block;
			margin: 0px auto;
		}
		</style>
	</head>
	<body>
		<canvas id="a"></canvas>
	</body>
	<script type="text/javascript">
function ja(a,b){return[a[0]-b[0],a[1]-b[1]]}function ka(a){var b=1/Math.sqrt(a[0]*a[0]+a[1]*a[1]);0>=b&&(b=1E-10);Infinity==b&&(b=Number.MAX_VALUE);-Infinity==b&&(b=Number.MIN_VALUE);return u(a,b)}function u(a,b){return[a[0]*b,a[1]*b,a[2]*b]}function la(){this.S=function(a){for(var b=0;24>b;b++)this[String.fromCharCode(97+b)]=a[b]||0;.01>this.c&&(this.c=.01);a=this.b+this.c+this.e;.18>a&&(a=.18/a,this.b*=a,this.c*=a,this.e*=a)}}
var x=new function(){this.F=new la;var a,b,e,d,c,h,l,y,z,I,p,W;this.reset=function(){var g=this.F;d=100/(g.f*g.f+.001);c=100/(g.g*g.g+.001);h=1-g.h*g.h*g.h*.01;l=-g.i*g.i*g.i*1E-6;g.a||(p=.5-g.n/2,W=5E-5*-g.o);y=1+g.l*g.l*(0<g.l?-.9:10);z=0;I=1==g.m?0:(1-g.m)*(1-g.m)*2E4+32};this.U=function(){this.reset();var g=this.F;a=g.b*g.b*1E5;b=g.c*g.c*1E5;e=g.e*g.e*1E5+12;return 3*((a+b+e)/3|0)};this.T=function(g,X){var f=this.F,Y=1!=f.s||f.v,v=f.v*f.v*.1,Z=1+3E-4*f.w,q=f.s*f.s*f.s*.1,sa=1+1E-4*f.t,ta=1!=f.s,
ua=f.x*f.x,va=f.g,aa=f.q||f.r,wa=f.r*f.r*f.r*.2,ba=f.q*f.q*(0>f.q?-1020:1020),ca=f.p?((1-f.p)*(1-f.p)*2E4|0)+32:0,xa=f.d,da=f.j/2,ya=f.k*f.k*.01,Q=f.a,R=a,za=1/a,Aa=1/b,Ba=1/e;f=5/(1+f.u*f.u*20)*(.01+q);.8<f&&(f=.8);f=1-f;for(var S=!1,ea=0,A=0,B=0,fa=0,J=0,C,D=0,m,r=0,t,T=0,k,ha=0,w,ia=0,K=Array(1024),E=Array(32),n=K.length;n--;)K[n]=0;for(n=E.length;n--;)E[n]=2*Math.random()-1;for(n=0;n<X;n++){if(S)return n;ca&&++ha>=ca&&(ha=0,this.reset());I&&++z>=I&&(I=0,d*=y);h+=l;d*=h;d>c&&(d=c,0<va&&(S=!0));
m=d;0<da&&(ia+=ya,m*=1+Math.sin(ia)*da);m|=0;8>m&&(m=8);Q||(p+=W,0>p?p=0:.5<p&&(p=.5));if(++A>R)switch(A=0,++ea){case 1:R=b;break;case 2:R=e}switch(ea){case 0:B=A*za;break;case 1:B=1+2*(1-A*Aa)*xa;break;case 2:B=1-A*Ba;break;case 3:B=0,S=!0}aa&&(ba+=wa,t=ba|0,0>t?t=-t:1023<t&&(t=1023));Y&&Z&&(v*=Z,1E-5>v?v=1E-5:.1<v&&(v=.1));w=0;for(var Ca=8;Ca--;){r++;if(r>=m&&(r%=m,3==Q))for(C=E.length;C--;)E[C]=2*Math.random()-1;switch(Q){case 0:k=r/m<p?.5:-.5;break;case 1:k=1-r/m*2;break;case 2:k=r/m;k=6.28318531*
(.5<k?k-1:k);k=1.27323954*k+.405284735*k*k*(0>k?1:-1);k=.225*((0>k?-1:1)*k*k-k)+k;break;case 3:k=E[Math.abs(32*r/m|0)]}Y&&(C=D,q*=sa,0>q?q=0:.1<q&&(q=.1),ta?(J+=(k-D)*q,J*=f):(D=k,J=0),D+=J,fa+=D-C,k=fa*=1-v);aa&&(K[T%1024]=k,k+=K[(T-t+1024)%1024],T++);w+=k}w*=.125*B*ua;g[n]=1<=w?32767:-1>=w?-32768:32767*w|0}return X}};
window.jsfxr=function(a){x.F.S(a);var b=x.U();a=new Uint8Array(4*((b+1)/2|0)+44);b=2*x.T(new Uint16Array(a.buffer,44),b);var e=new Uint32Array(a.buffer,0,44);e[0]=1179011410;e[1]=b+36;e[2]=1163280727;e[3]=544501094;e[4]=16;e[5]=65537;e[6]=44100;e[7]=88200;e[8]=1048578;e[9]=1635017060;e[10]=b;b+=44;e=0;for(var d="data:audio/wav;base64,";e<b;e+=3){var c=a[e]<<16|a[e+1]<<8|a[e+2];d+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[c>>18]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[c>>
12&63]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[c>>6&63]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[c&63]}return d};
function F(a,b,e){var d={A:[a,b],C:void 0===e?-1:e,H:0,target:null,B:10,max:100,G:1,D:0,N:function(c){c.fillStyle=ma(d.C);c.fillRect(d.A[0]-40,d.A[1]-40,80,80);c.textAlign="center";c.fillText(d.B,d.A[0],d.A[1]-50)},O:function(c){c.fillStyle="#FFFFFF";c.fillRect(d.A[0]-45,d.A[1]-45,90,90)},update:function(c){d.G-=c;0>=d.G&&(d.G=1,0<=d.C&&d.B<d.max&&(d.B+=1));0<this.D?this.D-=c:0<this.B&&0<this.H?(--this.B,--this.H,na(this.A[0],this.A[1],this.C,this.target),this.D+=.2):this.target=null},contains:function(c){var h=
d.A;return h[0]-40<c[0]&&h[1]-40<c[1]&&h[0]+40>c[0]&&h[1]+40>c[1]},attack:function(c){d.C==c?d.B+=1:0>=d.B?(d.C=c,d.B=1):--d.B},R:function(c){this.target=c;this.H=this.B/2}};G.push(d);H.push(d);return d}function ma(a){switch(a){case 0:return"#0000FF";case 1:return"#FF0000";case 2:return"#00FF00";default:return"#555555"}}
function na(a,b,e,d){var c=ja(d.A,[a,b]),h={A:[a,b],V:u(ka(c),100),I:Math.sqrt(c[0]*c[0]+c[1]*c[1])/100,C:e,target:d,B:1,N:function(l){l.fillStyle=ma(h.C);l.fillRect(h.A[0]-6,h.A[1]-6,12,12)},update:function(l){var y=h.A,z=u(h.V,l);h.A=[y[0]+z[0],y[1]+z[1]];h.I-=l;0>=h.I&&(d.attack(h.C),l=G.indexOf(h),-1<l&&G.splice(l,1),l=H.indexOf(h),-1<l&&H.splice(l,1))}};G.push(h);H.push(h)}var L,M=0,pa=oa(),qa=1/30,N=document.getElementById("a"),O=N.getContext("2d");N.width=1024;N.height=768;rect=N.getBoundingClientRect();
var P=null,G=[],H=[],U=[];U.push(F(300,300,0));U.push(F(300,500));U.push(F(700,500,1));U.push(F(700,300));
var V=function(a){function b(c,h){document.addEventListener(c,h,!1)}for(var e={key:[200],K:!1,M:!1,J:!1,P:!1,L:[0,0],update:function(){this.M=this.K=!1}},d=0;200>d;d++)e.key[d]=!1;b("contextmenu",function(c){c.preventDefault()},!1);b("keydown",function(c){e.key[c.keyCode]=!0},!1);b("keyup",function(c){e.key[c.keyCode]=!1},!1);b("click",function(){},!1);b("mousedown",function(c){0==c.button&&(e.K=!0,e.J=!0);2==c.button&&(e.M=!0,e.J=!0)},!1);b("mouseup",function(c){0==c.button&&(e.J=!1);2==c.button&&
(e.P=!1)},!1);b("mousemove",function(c){e.L[0]=c.clientX-a.left;e.L[1]=c.clientY-a.top},!1);return e}(rect);G.push(V);function oa(){var a=window.performance;return a&&a.now?a.now():(new Date).getTime()}function ra(){O.fillStyle="#101010";O.fillRect(0,0,1024,768);null!=P&&P.O(O);H.forEach(function(a){return a.N(O)});O.font="14pt Arial"}function Da(){var a=M;V.K&&(P=Ea());if(V.M){var b=Ea();null!=P&&null!=b&&P.R(b)}G.forEach(function(e){return e.update(a)})}
function Ea(){for(var a=V.L,b=0;b<U.length;b++)if(U[b].contains(a))return U[b];return null}function Fa(){L=oa();M=Math.min(1,(L-pa)/1E3);M>qa&&(M=qa);pa=L;Da();ra();requestAnimationFrame(Fa)}requestAnimationFrame(Fa);
</script>
</html>