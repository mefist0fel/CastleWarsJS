<html>
	<head>
		<title>Castles</title>
		<style type="text/css">
		body {
			display: block;
			background-color:0;
			width: 100%;
			height: 100%;
			margin: 0;
		}
		canvas {
			background-color:0;
			display: block;
			margin: 0px auto;
		}
		</style>
	</head>
	<body>
		<canvas id="a"></canvas>
	</body>
	<script type="text/javascript">

const ba=Number.MAX_VALUE,ca=Number.MIN_VALUE,da=Math.PI,ea=Math.cos,ha=Math.sin,ia=Math.min,ja=Math.max,ka=Math.round,la=Math.random,ma=Math.floor;function n(a){return ja(ia(a,1),0)}function na(a,b){return[a[0]-b[0],a[1]-b[1]]}function oa(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function pa(a){var b=1/oa(a);Infinity==b&&(b=ba);-Infinity==b&&(b=ca);return[a[0]*b,a[1]*b]}function q(a=0,b=0,d=0){return[a,b,d]}function r(a,b){return[a[0]+b[0],a[1]+b[1],a[2]+b[2]]}
function v(a,b){return[a[0]*b,a[1]*b,a[2]*b]}function va(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2])};function x(a,b){wa.addEventListener(a,b,!1)};function xa(){this.O=function(a){for(var b=0;24>b;b++)this[String.fromCharCode(97+b)]=a[b]||0;.01>this.c&&(this.c=.01);a=this.b+this.c+this.e;.18>a&&(a=.18/a,this.b*=a,this.c*=a,this.e*=a)}}
var ya=new function(){this.O=new xa;var a,b,d,c,g,l,p,m,w,z,t,f;this.ka=function(){var e=this.O;c=100/(e.f*e.f+.001);g=100/(e.g*e.g+.001);l=1-e.h*e.h*e.h*.01;p=-e.i*e.i*e.i*1E-6;e.a||(t=.5-e.n/2,f=5E-5*-e.o);m=1+e.l*e.l*(0<e.l?-.9:10);w=0;z=1==e.m?0:(1-e.m)*(1-e.m)*2E4+32};this.ra=function(){this.ka();var e=this.O;a=e.b*e.b*1E5;b=e.c*e.c*1E5;d=e.e*e.e*1E5+12;return 3*((a+b+d)/3|0)};this.qa=function(e,h){var k=this.O,B=1!=k.s||k.v,F=k.v*k.v*.1,P=1+3E-4*k.w,Y=k.s*k.s*k.s*.1,Pb=1+1E-4*k.t,Qb=1!=k.s,
Rb=k.x*k.x,Sb=k.g,hb=k.q||k.r,Tb=k.r*k.r*k.r*.2,ib=k.q*k.q*(0>k.q?-1020:1020),jb=k.p?((1-k.p)*(1-k.p)*2E4|0)+32:0,Ub=k.d,kb=k.j/2,Vb=k.k*k.k*.01,Ma=k.a,Na=a,Wb=1/a,Xb=1/b,Yb=1/d;k=5/(1+k.u*k.u*20)*(.01+Y);.8<k&&(k=.8);k=1-k;for(var Oa=!1,lb=0,qa=0,ra=0,mb=0,Ba=0,sa,ta=0,L,Z=0,aa,Pa=0,u,nb=0,fa,ob=0,Ca=Array(1024),ua=Array(32),M=Ca.length;M--;)Ca[M]=0;for(M=ua.length;M--;)ua[M]=2*Math.random()-1;for(M=0;M<h;M++){if(Oa)return M;jb&&++nb>=jb&&(nb=0,this.ka());z&&++w>=z&&(z=0,c*=m);l+=p;c*=l;c>g&&(c=
g,0<Sb&&(Oa=!0));L=c;0<kb&&(ob+=Vb,L*=1+Math.sin(ob)*kb);L|=0;8>L&&(L=8);Ma||(t+=f,0>t?t=0:.5<t&&(t=.5));if(++qa>Na)switch(qa=0,++lb){case 1:Na=b;break;case 2:Na=d}switch(lb){case 0:ra=qa*Wb;break;case 1:ra=1+2*(1-qa*Xb)*Ub;break;case 2:ra=1-qa*Yb;break;case 3:ra=0,Oa=!0}hb&&(ib+=Tb,aa=ib|0,0>aa?aa=-aa:1023<aa&&(aa=1023));B&&P&&(F*=P,1E-5>F?F=1E-5:.1<F&&(F=.1));fa=0;for(var Zb=8;Zb--;){Z++;if(Z>=L&&(Z%=L,3==Ma))for(sa=ua.length;sa--;)ua[sa]=2*Math.random()-1;switch(Ma){case 0:u=Z/L<t?.5:-.5;break;
case 1:u=1-Z/L*2;break;case 2:u=Z/L;u=6.28318531*(.5<u?u-1:u);u=1.27323954*u+.405284735*u*u*(0>u?1:-1);u=.225*((0>u?-1:1)*u*u-u)+u;break;case 3:u=ua[Math.abs(32*Z/L|0)]}B&&(sa=ta,Y*=Pb,0>Y?Y=0:.1<Y&&(Y=.1),Qb?(Ba+=(u-ta)*Y,Ba*=k):(ta=u,Ba=0),ta+=Ba,mb+=ta-sa,u=mb*=1-F);hb&&(Ca[Pa%1024]=u,u+=Ca[(Pa-aa+1024)%1024],Pa++);fa+=u}fa*=.125*ra*Rb;e[M]=1<=fa?32767:-1>=fa?-32768:32767*fa|0}return h}};
window.jsfxr=function(a){ya.O.O(a);var b=ya.ra();a=new Uint8Array(4*((b+1)/2|0)+44);b=2*ya.qa(new Uint16Array(a.buffer,44),b);var d=new Uint32Array(a.buffer,0,44);d[0]=1179011410;d[1]=b+36;d[2]=1163280727;d[3]=544501094;d[4]=16;d[5]=65537;d[6]=44100;d[7]=88200;d[8]=1048578;d[9]=1635017060;d[10]=b;b+=44;d=0;for(var c="data:audio/wav;base64,";d<b;d+=3){var g=a[d]<<16|a[d+1]<<8|a[d+2];c+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[g>>18]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[g>>
12&63]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[g>>6&63]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[g&63]}return c};var y=[],za=q(1,0,0),Aa=q(0,1,0),Da=q(0,0,1),Ea=q(0,0,-20),Fa=q(),Ga=null,Ha=1.6,Ia=1;function Ja(){var a=Ka;let b=a/180*da;a=(a/180+.5)*da;za=q(ea(b),.6*ha(b),ha(b));Aa=q(ea(a),.6*ha(a),ha(a));Da=q(0,-.6,2)}function La(a,b){return a.depth<b.depth?1:a.depth>b.depth?-1:0}function Qa(a){a=r(a,v(Fa,-1));a=r(r(v(za,a[0]),v(Aa,a[1])),v(Da,a[2]));a=r(a,Ea);a=v(a,Ha*Ia*(1+1E-4*a[2]));return r(a,Ga)}
function Ra(a,b,d,c,g=q(1,1,1),l=0){var p={ha:[a,b,d,c],depth:0,color:g,enable:!0,$(m,w,z,t,f=null){this.points=[m,w,z,t];if(null==f){m=p.points;w=q();for(z=0;z<m.length;z++)w=r(w,m[z]);m=v(w,1/parseFloat(m.length))}else m=f;this.position=m;this.position[2]=0},setColor(m){p.color=m},ga(){if(p.enable){p.depth=-Qa(p.position)[2]+l;for(let m=0;m<p.ha.length;m++)p.ha[m]=Qa(p.points[m])}},ca(){p.enable&&(A.fillStyle=Sa(p.color),Ta(p.ha))}};p.$(a,b,d,c);y.push(p);return p}
function Ta(a){var b=a[0],d=na(a[1],b);d=pa([d[1],-d[0]]);b=na(b,a[2]);if(!(0<d[0]*b[0]+d[1]*b[1])){A.beginPath();b=a[3];A.moveTo(b[0],b[1]);for(b=0;4>b;b++)A.lineTo(a[b][0],a[b][1]);A.closePath();A.fill()}}function Sa(a){let b=ka(255*n(a[0])),d=ka(255*n(a[1]));a=ka(255*n(a[2]));return Ua(b,d,a)}function Ua(a,b,d){function c(g){g=g.toString(16);return 1==g.length?"0"+g:g}return"#"+c(a)+c(b)+c(d)+c(255)};let Va=1,Wa=[];for(var C=0;1E4>C;C++)Va=16807*Va%2147483647,Wa.push(la(Va/2147483647));function D(a,b,d,c=1E3){a=a*d+c;c=b*d+1E3;b=ma(a);d=ma(c);a-=b;c-=d;return(Wa[b%100*100+d%100]*(1-a)+Wa[(b+1)%100*100+d%100]*a)*(1-c)+(Wa[b%100*100+(d+1)%100]*(1-a)+Wa[(b+1)%100*100+(d+1)%100]*a)*c};let E=Array,Xa=[];const Ya=[q(-1,1),q(-1,-1),q(1,1),q(1,-1)];
function Za(a,b,d=-1,c=0){function g(f,e,h,k,B=null){e=l(e,h,k);return 0<=e&&e<f.length?f[e]:B}function l(f,e,h=1,k=1){return f*h+e*k}function p(f,e,h){f>e?(f-=h,f<e&&(f=e)):(f+=h,f>e&&(f=e));return f}let m=4*a;d={H:E(a*a),M:E(a*a),points:E(a*a*4),G:E(a*a),I:E(a*a),aa:E(a*a),V:E(a*a),U:E(a*a),size:a,threshold:d,ja(f,e,h){var k=this.M;f=l(f,e,this.size);0<=f&&f<k.length&&(k[f]=h)},va(f,e){return g(this.M,f,e,this.size,0)},setColor(f,e,h){var k=this.I;f=l(f,e,this.size);0<=f&&f<k.length&&(k[f]=h)},
ua(f,e){return g(this.I,f,e,this.size,q())},update(f){let e=!1;for(var h=0;h<this.M.length;h++)this.H[h]!=this.M[h]&&(this.H[h]=p(this.H[h],this.M[h],50*f),e=!0);for(h=0;h<this.I.length;h++)if(this.G[h][0]!=this.I[h][0]||this.G[h][1]!=this.I[h][1]||this.G[h][2]!=this.I[h][2])e=!0,this.G[h][0]=p(this.G[h][0],this.I[h][0],2*f),this.G[h][1]=p(this.G[h][1],this.I[h][1],2*f),this.G[h][2]=p(this.G[h][2],this.I[h][2],2*f);e&&this.J()},J(){for(var f=0;f<this.size;f++)for(var e=0;e<this.size;e++){var h=l(f,
e,this.size);h=q((f-w)*b,(e-w)*b,this.H[h]);for(var k=0;4>k;k++){var B=l(2*f+Math.floor(k/2),2*e+k%2,m);this.points[B]=r(h,v(Ya[k],z))}}for(f=0;f<this.size;f++)for(e=0;e<this.size;e++)h=l(f,e,this.size),this.aa[h].$(this.points[l(2*f,2*e,m)],this.points[l(2*f+1,2*e,m)],this.points[l(2*f+1,2*e+1,m)],this.points[l(2*f,2*e+1,m)]),this.aa[h].setColor(this.G[h]),this.aa[h].enable=this.H[h]>=this.threshold,f<this.size-1&&(this.V[h].$(this.points[l(2*f+1,2*e,m)],this.points[l(2*f+2,2*e,m)],this.points[l(2*
f+2,2*e+1,m)],this.points[l(2*f+1,2*e+1,m)]),k=l(f+1,e,this.size),this.H[h]>this.H[k]?(B=v(this.G[h],.8),this.V[h].enable=this.H[h]>=this.threshold):(B=v(this.G[k],.8),this.V[h].enable=this.H[k]>=this.threshold),this.V[h].setColor(B)),e<this.size-1&&(this.U[h].$(this.points[l(2*f+1,2*e,m)],this.points[l(2*f,2*e,m)],this.points[l(2*f,2*e+3,m)],this.points[l(2*f+1,2*e+3,m)]),k=l(f,e+1,this.size),this.H[h]>this.H[k]?(B=v(this.G[h],.7),this.U[h].enable=this.H[h]>=this.threshold):(B=v(this.G[k],.7),this.U[h].enable=
this.H[k]>=this.threshold),this.U[h].setColor(B))},clear(f=0){for(var e=0;e<this.size;e++)for(var h=0;h<this.size;h++){let k=l(e,h,this.size);this.M[k]=f}this.J()}};let w=.5*(a-1),z=.5*b;for(a=0;a<d.size;a++)for(var t=0;t<d.size;t++){let f=l(a,t,d.size);d.H[f]=d.threshold;d.M[f]=d.threshold;let e=q(1,1,1);d.aa[f]=Ra(e,e,e,e,e,c);d.V[f]=Ra(e,e,e,e,e,c);d.U[f]=Ra(e,e,e,e,e,c);d.I[f]=e;d.G[f]=q(0,0,0)}d.J();Xa.push(d);return d}
function $a(a){let b=n(.3+.1*a),d=n(.5+.5*a);a=n(.3+.1*a);return q(b,d,a)}function ab(a){0>a&&(a-=.5);let b=n(.5+.9*a),d=n(.5+.9*a);a=n(.7+1.5*a);return q(b,d,a)}function G(a,b,d){for(var c=bb,g=0;5>g;g++)for(var l=0;5>l;l++)c.ja(a+g,b+l,6*d[5*g+l])}function cb(a,b,d,c){for(var g=bb,l=0;l<d;l++)for(var p=0;p<d;p++)g.setColor(a+l,b+p,c)}var bb=Za(85,10,0,-50),db=Za(35,50,-100);
function eb(a,b){for(var d=0;35>d;d++)for(var c=0;35>c;c++){let g=a(d,c),l=n(va(q(d-17,c-17))/17*2.4-1);g*=l;0<d&&0<c&&34>d&&34>c||(g=-100.01);db.ja(d,c,g);db.setColor(d,c,b(d,c))}}function H(a,b){return n(va(q(a-17,b-17))/17*2.4-1)}db.J();
function fb(a){for(C=0;C<gb.length;C++)I(J,gb[C]),I(y,gb[C]);gb=[];for(C=0;C<K.length;C++)I(J,K[C]),I(y,K[C]);K=[];bb.clear(-1E-5);pb.enable=!0;switch(a){case -1:a=[7,6,7,6,7,6,6,6,6,6,7,6,2,6,7,6,6,6,6,6,7,6,7,6,7];var b=[-1E-4,4,3,4,-1E-4,-1E-4,3,3,3,-1E-4,-1E-4,4,3,4,-1E-4,-1E-4,3,3,3,-1E-4,-1E-4,4,3,4,-1E-4];const d=[-1E-4,-1E-4,-1E-4,-1E-4,-1E-4,4,3,4,3,4,3,3,3,3,3,4,3,4,3,4,-1E-4,-1E-4,-1E-4,-1E-4,-1E-4];G(33,33,a);G(33,47,a);G(47,47,a);G(47,33,a);G(40,40,[15,12,15,12,15,12,12,12,12,12,15,12,
12,12,15,12,12,12,12,12,15,12,15,12,15]);G(38,33,b);G(42,33,b);G(38,47,b);G(42,47,b);G(33,38,d);G(33,42,d);G(47,38,d);G(47,42,d);cb(30,30,25,qb(0));eb((c,g)=>80*D(c,g,.3)*H(c,g),(c,g)=>$a(D(c,g,.3)*H(c,g)));break;case 0:rb="tutorial";N(3,3,0,1);N(-3,-3,1,1);N(-1,1);N(1,-1);sb();pb.enable=!1;eb((c,g)=>80*D(c,g,.3,300)*H(c,g),(c,g)=>$a(D(c,g,.3,300)*H(c,g)));break;default:case 1:rb="vikings raid";N(3,3,0,1);N(-3,-3,1,1);N(0,0);N(-3,0);N(3,0);N(0,-3);N(0,3);sb();eb((c,g)=>180*(D(c,g,.35,300)-.5)*H(c,
g),(c,g)=>ab(.5*D(c,g,.35,300)*H(c,g)));break;case 2:rb="desert storm";N(0,6,0,2);N(0,-6,1,2);for(a=-1;2>a;a++)for(b=-1;2>b;b++)N(3*a,3*b);sb();eb((c,g)=>80*D(c,g,.45)*H(c,g),(c,g)=>{var l=D(c,g,.45)*H(c,g);c=n(.5+.5*l);g=n(.5+.5*l);l=n(.3+.1*l);return q(c,g,l)});break;case 3:rb="Normann clash";N(3,3,0,1);N(-3,-3,1,1);N(-3,3,2,1);N(3,-3,3,1);N(0,0);N(-3,0);N(3,0);N(0,-3);N(0,3);sb();eb((c,g)=>80*D(c,g,.35,300)*H(c,g),(c,g)=>ab(D(c,g,.35,300)*H(c,g)));break;case 4:rb="Great war";N(0,6,0,2);N(0,-6,
1,2);N(6,0,2,2);N(-6,0,3,2);for(a=-1;2>a;a++)for(b=-1;2>b;b++)N(3*a,3*b);sb();eb((c,g)=>160*(D(c,g,.3,300)-.7)*H(c,g),(c,g)=>$a((D(c,g,.3,300)-.7)*H(c,g)))}};var K=[],O=null;
function N(a,b,d=-1,c=0){const g=[1,2,3],l=[15,20,999],p=[50,80,100],m=q(1,1,1),w=q(.5,.5,.5),z=[[-1E-4,-1E-4,-1E-4,-1E-4,-1E-4,-1E-4,4,2,4,-1E-4,-1E-4,2,0,2,-1E-4,-1E-4,4,2,4,-1E-4,-1E-4,-1E-4,-1E-4,-1E-4,-1E-4],[-1E-4,4,2,4,-1E-4,4,2,2,2,4,2,2,5,2,2,4,2,2,2,4,-1E-4,4,2,4,-1E-4],[4,2,3,2,4,2,7,5,7,2,3,5,3,5,3,2,7,5,7,2,4,2,3,2,4]];var t={B:[a,b],position:q(50*a,50*b),C:q(),L:q(),N:[10,10],D:d,W:0,na:null,F:null,target:null,level:c,A:10,Z:1,T:0,ma:[],P:0,depth:0,K:null,ga(){this.C=Qa(this.position);
this.L=Qa(r(this.position,q(0,0,64)));let f=Math.abs(this.L[1]-this.C[1]);this.N=[1.2*f,f];this.depth=-this.C[2]-1E3},ca(){A.fillStyle=Sa(qb(this.D));A.fillText(this.A,this.L[0],this.L[1]);this.A>=l[this.level]&&A.fillText("^",this.L[0]+.5*this.N[0],this.L[1]);if(null!=this.F)for(var f=this.F.split("\n"),e=0;e<f.length;e++)A.fillText(f[e],this.L[0],this.L[1]-this.N[1]*(f.length-e))},upgrade(){this.A>=l[t.level]&&(this.A-=l[t.level],this.level+=1,this.J())},update(f){this.Z-=f;0>=this.Z&&(this.Z=1,
0<=this.D&&t.A<p[t.level]&&(this.A+=g[this.level]));if(0<this.T)this.T-=f;else if(0<this.A&&0<this.W){for(f=3;0<f&&0<this.W&&0<this.A;)--this.A,--this.W,tb(this.B[0],this.B[1],this.D,this.na,f-2),--f;this.T+=.3}else this.target=null},contains(f,e){return this.C[0]-this.N[0]<f&&this.C[1]-this.N[1]<e&&this.C[0]+this.N[0]>f&&this.C[1]+this.N[1]>e},attack(f){this.D==f?this.A+=1:0>=this.A?(this.D=f,0<this.level&&--this.level,this.J(),this.A=1):--this.A},ia(f){if(null!=f&&null!=f.K){this.target=f;this.W=
this.A/2;var e=[];for(e.push(f);null!=f.K;)f=f.K,e.push(f);this.na=e}},J(){G(40+5*this.B[0],40+5*this.B[1],z[this.level]);cb(40+5*this.B[0],40+5*this.B[1],5,qb(this.D));bb.J()},ta(f){var e=-1E-5,h=w;null!=this.K&&(e=0,h=w);f&&(e=0,h=m);f=39+5*this.B[0];for(var k=39+5*this.B[1],B=bb,F=0;7>F;F++)for(var P=0;7>P;P++)if(0==F||0==P||6==F||6==P)B.ja(f+F,k+P,e),B.setColor(f+F,k+P,h)},wa(){I(J,t);I(y,t);I(K,t)}};J.push(t);y.push(t);K.push(t);t.J()}function ub(){K.forEach(a=>a.ta(a==O));bb.J()}
function qb(a){switch(a){case 0:return q(.2,.2,.95);case 1:return q(.9,.2,.2);case 2:return q(.2,.9,.2);case 3:return q(.9,.9,.2);default:return q(.6,.6,.6)}}function vb(){var a=Q.X;let b=a[0];a=a[1];for(var d=0;d<K.length;d++)if(K[d].contains(b,a))return K[d];return null}function sb(){for(var a=0;a<K.length;a++)for(var b=0;b<K.length;b++)a!=b&&6>oa(na(K[a].B,K[b].B))&&K[a].ma.push(K[b])}
function wb(a){K.forEach(d=>{d.P=99999;d.K=null});if(null!=a){var b=[];b.push(a);for(a.P=0;0<b.length;){let d=b.pop();d.ma.forEach(c=>{let g=d.P+oa(na(d.B,c.B));c.P>g&&(c.P=g,c.K=d,c.D==a.D&&b.push(c))})}}};const xb=[0,0];var gb=[];
function tb(a,b,d,c,g=0){var l={offset:g,fa:[0,0],B:[a,b],position:q(50*a,50*b),C:q(),oa:q(),pa:xb,S:0,da:d,target:null,path:[...c],A:1,ga(){this.C=Qa(this.position);this.oa=Qa(r(this.position,q(0,0,5)));this.depth=-this.C[2]-500},ca(){var p=Math.abs(this.C[2]-this.oa[2]),m=.2*p,w=.34*p;let z=[r(this.C,q(0,m)),r(this.C,q(w,0)),r(this.C,q(w,-p)),r(this.C,q(0,-p))];p=[r(this.C,q(0,m)),r(this.C,q(0,-p)),r(this.C,q(-w,-p)),r(this.C,q(-w,0))];A.fillStyle=Sa(v(qb(this.da),.95));Ta(z);A.fillStyle=Sa(v(qb(this.da),
.85));Ta(p)},update(p){var m=this.pa;m=[m[0]*p,m[1]*p];var w=this.B;this.B=[w[0]+m[0],w[1]+m[1]];this.position=[50*(this.B[0]+this.fa[0]*this.offset*.2),50*(this.B[1]+this.fa[1]*this.offset*.2),2*ha(30*this.S+this.offset)];this.S-=p;0>=this.S&&(0<this.path.length?(this.target=this.path.pop(),m=na(this.target.B,this.B),p=pa(m),this.fa=[-p[1],p[0]],m=oa(m),this.pa=[1*p[0],1*p[1]],this.S=m/1):(this.target.attack(this.da),I(J,l),I(y,l),I(gb,l)))}};J.push(l);y.push(l);gb.push(l)}
function I(a,b){b=a.indexOf(b);-1<b&&a.splice(b,1)};function yb(a=1){a={enable:!0,D:a,ba:.5,threshold:20,update(b){this.enable&&(this.ba-=b,0>this.ba&&(this.ba=.5+la(),K.forEach(d=>{d.D==this.D&&(d.A>this.threshold&&(3<d.level&&this.la(d),.3>la()?d.upgrade():this.la(d)),this.threshold=20+la(15))})))},la(b){wb(b);let d=[];K.forEach(c=>{c!=b&&null!=c.K&&c.D!=this.D&&d.push(c)});0==d.length&&K.forEach(c=>{c!=b&&null!=c.K&&c.D==this.D&&d.push(c)});0<d.length&&b.ia(d[Math.floor(la()*d.length)])}};J.push(a);return a};var zb,Ab=0,Cb=Bb(),Db=1/30,wa=document,Eb=wa.getElementById("a"),A=Eb.getContext("2d"),R=1,S=1,Fb=1,Gb=1,Hb=1,Ib=1,Jb=wa.documentElement,Kb=0,Ka=0,J=[];Lb();
var Q=function(a){for(var b={key:[200],R:!1,Y:!1,ea:!1,sa:!1,X:[0,0],update(){this.Y=this.R=!1}},d=0;200>d;d++)b.key[d]=!1;x("contextmenu",function(c){c.preventDefault()});x("keydown",function(c){b.key[c.keyCode]=!0});x("keyup",function(c){b.key[c.keyCode]=!1});x("click",function(){});x("mousedown",function(c){0==c.button&&(b.R=!0,b.ea=!0);2==c.button&&(b.Y=!0,b.ea=!0)});x("mouseup",function(c){0==c.button&&(b.ea=!1);2==c.button&&(b.sa=!1)});x("mousemove",function(c){b.X[0]=c.clientX-a.left;b.X[1]=
c.clientY-a.top});return b}(Eb.getBoundingClientRect()),pb=yb(),T=0,rb=null,Mb=0,U=null;yb(2);yb(3);Ha=.7;V(0);W();function Nb(){A.fillStyle="#101010";A.fillRect(0,0,R,S);for(var a=0;a<y.length;a++)y[a].ga();y.sort(La);for(a=0;a<y.length;a++)y[a].ca()}function V(a){0==a?(fb(-1),U=Ob):-1==a?(fb(T),U=$b):-2==a?U=ac:-3==a?U=bc:1==a&&(0==T?(Mb=0,cc(),U=dc):U=ec)}function fc(a){Ha=.02*a+.98*Ha}function gc(a){Ka+=8*a;360<Ka&&(Ka-=360);Ja()}function hc(a){Kb+=.1*a;Ka=.9*Ka+.1*(10*ha(Kb)+65);Ja()}
function ac(a){fc(1.2);gc(a);Xa.forEach(b=>b.update(a));Nb();A.fillStyle="#66FF66";W(60);ic("You won!",-35);W();X("menu",0,0,18)&&V(0);X("next",0,20,18)&&(T+=1,V(-1));Q.key[27]&&V(0)}function bc(a){fc(1.2);gc(a);Xa.forEach(b=>b.update(a));Nb();A.fillStyle="#FF6666";W(60);ic("You lose!",-35);W();X("menu",0,0,18)&&V(0);X("restart",0,20,18)&&V(-1);Q.key[27]&&V(0)}
function Ob(a){fc(1.2);gc(a);Xa.forEach(b=>b.update(a));Nb();A.fillStyle="#FFFFFF";W(60);ic("CASTLE WARS",-35);W();X("start",0,20,18)&&V(-1);Q.key[32]&&V(-1)}function $b(a){fc(1.4);Xa.forEach(b=>b.update(a));hc(a);Nb();A.fillStyle="#FFFFFF";W(40);ic("Select level",-35);W(32);null!=rb&&ic(rb,-25);W();X("start",0,20,18)&&V(1);Q.key[32]&&V(1);Q.key[27]&&V(0);if(X(">>",16,20,9)||Q.key[39])T+=1,fb(T);if(0<T&&X("<<",-16,20,9)||Q.key[37])--T,fb(T)}
function cc(){Mb+=1;switch(Mb){case 1:K[0].F="this is your castle\nprotect it";K[1].F=null;return;case 2:K[1].F="it's your enemy\ndestroy him!";return;case 3:K[0].F="your castles produce troops\nselect your castle";K[1].F=null;return;case 4:O=K[0];wb(O);ub();K[0].F=null;K[1].F=null;K[2].F="right click to send\nyour troops to attack";return;case 5:K[0].A=ia(K[0].A,25);K[0].ia(K[2]);K[2].F="you need more troops\nto capture enemy castle";return;case 6:K[0].A=ia(K[0].A,21);K[0].F="you also can use your troops\nto upgrade ^ your castles";
K[2].F=null;return;case 7:K[0].A=ia(K[0].A,21);K[0].F="better castles produce more troops\nright click on your castle to upgrade it";return;case 8:K[0].upgrade();K[0].F="your battle begins!";return}K[0].F=null;K[1].F="Defeat your enemies!";U=ec}function dc(a){fc(1.6);Xa.forEach(b=>b.update(a));Q.key[27]&&V(0);(Q.R||Q.Y)&&cc();J.forEach(b=>b.update(a));hc(a);Nb()}
function ec(a){fc(1.6);Xa.forEach(c=>c.update(a));Q.key[27]&&V(0);Q.R&&(O=vb(),null!=O&&0!=O.D&&(O=null),wb(O),ub());if(Q.Y){let c=vb();null!=O&&null!=c&&(O==c?O.upgrade():(wb(O),O.ia(c)))}let b=0,d=0;K.forEach(c=>{0==c.D&&(b+=1);1==c.D&&(d+=1)});0==b&&V(-3);0==d&&V(-2);J.forEach(c=>c.update(a));hc(a);Nb()}function Bb(){let a=window.performance;return a&&a.now?a.now():(new Date).getTime()}let jc=requestAnimationFrame;
function kc(){zb=Bb();Ab=Math.min(1,(zb-Cb)/1E3);Ab>Db&&(Ab=Db);Cb=zb;U(Ab);jc(kc);Q.update();R==Jb.clientWidth&&S==Jb.clientHeight||Lb()}jc(kc);function Lb(){R=Jb.clientWidth;S=Jb.clientHeight;Fb=Math.min(R,S);Gb=.5*R;Hb=.5*S;Ib=.01*Fb;Eb.width=R;Eb.height=S;var a=R,b=S;Ga=q(.5*a,.5*b);Ia=Math.min(a,b)/1024}function W(a=24){S>R&&(a*=S/R);A.font=parseInt(a)+"pt Arial";A.textAlign="center"}function ic(a,b){A.fillText(a,0*Ib+Gb,b*Ib+Hb)}
function X(a,b,d,c){c=c*Ib*.5;let g=3*Ib;b=b*Ib+Gb;d=d*Ib+Hb;A.fillStyle="#66666699";A.fillRect(b-c,d-g-12,2*c,2*g);A.fillStyle="#FFFFFF";A.fillText(a,b,d);return Q.R&&(a=Q.X,b-c<a[0]&&d-g<a[1]&&b+c>a[0]&&d+g>a[1])?(Q.update(1),!0):!1};


</script>
</html>