<html>
	<head>
		<title>Castles</title>
		<style type="text/css">
		body {
			display: block;
			background-color:0;
			width: 100%;
			height: 100%;
			margin: 0;
		}
		canvas {
			background-color:0;
			display: block;
			margin: 0px auto;
		}
		</style>
	</head>
	<body>
		<canvas id="a"></canvas>
	</body>
	<script type="text/javascript">
function ba(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}}function ca(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];if(b)return b.call(a);if("number"==typeof a.length)return{next:ba(a)};throw Error(String(a)+" is not an iterable or ArrayLike");}function da(a){for(var b,g=[];!(b=a.next()).done;)g.push(b.value);return g}var ea=Number.MAX_VALUE,ia=Number.MIN_VALUE,ja=Math.PI,ka=Math.cos,p=Math.sin,la=Math.min,ma=Math.max,na=Math.round;
function w(a){return ma(la(a,1),0)}function x(a,b){return[a[0]-b[0],a[1]-b[1]]}function oa(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function pa(a){var b=1/oa(a);Infinity==b&&(b=ea);-Infinity==b&&(b=ia);return[a[0]*b,a[1]*b]}function y(a,b,g){return[void 0===a?0:a,void 0===b?0:b,void 0===g?0:g]}function z(a,b){return[a[0]+b[0],a[1]+b[1],a[2]+b[2]]}function A(a,b){return[a[0]*b,a[1]*b,a[2]*b]}function B(a,b){ua.addEventListener(a,b,!1)}
function va(){this.ma=function(a){for(var b=0;24>b;b++)this[String.fromCharCode(97+b)]=a[b]||0;.01>this.c&&(this.c=.01);a=this.b+this.c+this.e;.18>a&&(a=.18/a,this.b*=a,this.c*=a,this.e*=a)}}
var wa=new function(){this.S=new va;var a,b,g,l,q,e,k,n,v,r,h,f;this.reset=function(){var d=this.S;l=100/(d.f*d.f+.001);q=100/(d.g*d.g+.001);e=1-d.h*d.h*d.h*.01;k=-d.i*d.i*d.i*1E-6;d.a||(h=.5-d.n/2,f=5E-5*-d.o);n=1+d.l*d.l*(0<d.l?-.9:10);v=0;r=1==d.m?0:(1-d.m)*(1-d.m)*2E4+32};this.oa=function(){this.reset();var d=this.S;a=d.b*d.b*1E5;b=d.c*d.c*1E5;g=d.e*d.e*1E5+12;return 3*((a+b+g)/3|0)};this.na=function(d,m){var c=this.S,t=1!=c.s||c.v,O=c.v*c.v*.1,Ea=1+3E-4*c.w,G=c.s*c.s*c.s*.1,jb=1+1E-4*c.t,kb=
1!=c.s,lb=c.x*c.x,mb=c.g,Fa=c.q||c.r,nb=c.r*c.r*c.r*.2,Ga=c.q*c.q*(0>c.q?-1020:1020),Ha=c.p?((1-c.p)*(1-c.p)*2E4|0)+32:0,ob=c.d,Ia=c.j/2,pb=c.k*c.k*.01,qa=c.a,ra=a,qb=1/a,rb=1/b,sb=1/g;c=5/(1+c.u*c.u*20)*(.01+G);.8<c&&(c=.8);c=1-c;for(var sa=!1,Ja=0,W=0,X=0,Ka=0,fa=0,Y,Z=0,C,H=0,I,ta=0,u,La=0,P,Ma=0,ha=Array(1024),aa=Array(32),E=ha.length;E--;)ha[E]=0;for(E=aa.length;E--;)aa[E]=2*Math.random()-1;for(E=0;E<m;E++){if(sa)return E;Ha&&++La>=Ha&&(La=0,this.reset());r&&++v>=r&&(r=0,l*=n);e+=k;l*=e;l>q&&
(l=q,0<mb&&(sa=!0));C=l;0<Ia&&(Ma+=pb,C*=1+Math.sin(Ma)*Ia);C|=0;8>C&&(C=8);qa||(h+=f,0>h?h=0:.5<h&&(h=.5));if(++W>ra)switch(W=0,++Ja){case 1:ra=b;break;case 2:ra=g}switch(Ja){case 0:X=W*qb;break;case 1:X=1+2*(1-W*rb)*ob;break;case 2:X=1-W*sb;break;case 3:X=0,sa=!0}Fa&&(Ga+=nb,I=Ga|0,0>I?I=-I:1023<I&&(I=1023));t&&Ea&&(O*=Ea,1E-5>O?O=1E-5:.1<O&&(O=.1));P=0;for(var tb=8;tb--;){H++;if(H>=C&&(H%=C,3==qa))for(Y=aa.length;Y--;)aa[Y]=2*Math.random()-1;switch(qa){case 0:u=H/C<h?.5:-.5;break;case 1:u=1-H/
C*2;break;case 2:u=H/C;u=6.28318531*(.5<u?u-1:u);u=1.27323954*u+.405284735*u*u*(0>u?1:-1);u=.225*((0>u?-1:1)*u*u-u)+u;break;case 3:u=aa[Math.abs(32*H/C|0)]}t&&(Y=Z,G*=jb,0>G?G=0:.1<G&&(G=.1),kb?(fa+=(u-Z)*G,fa*=c):(Z=u,fa=0),Z+=fa,Ka+=Z-Y,u=Ka*=1-O);Fa&&(ha[ta%1024]=u,u+=ha[(ta-I+1024)%1024],ta++);P+=u}P*=.125*X*lb;d[E]=1<=P?32767:-1>=P?-32768:32767*P|0}return m}};
window.jsfxr=function(a){wa.S.ma(a);var b=wa.oa();a=new Uint8Array(4*((b+1)/2|0)+44);b=2*wa.na(new Uint16Array(a.buffer,44),b);var g=new Uint32Array(a.buffer,0,44);g[0]=1179011410;g[1]=b+36;g[2]=1163280727;g[3]=544501094;g[4]=16;g[5]=65537;g[6]=44100;g[7]=88200;g[8]=1048578;g[9]=1635017060;g[10]=b;b+=44;g=0;for(var l="data:audio/wav;base64,";g<b;g+=3){var q=a[g]<<16|a[g+1]<<8|a[g+2];l+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[q>>18]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[q>>
12&63]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[q>>6&63]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[q&63]}return l};var D=[],xa=y(1,0,0),ya=y(0,1,0),za=y(0,0,1),Aa=y(0,0,-20),Ba=y(),Ca=null,Da=1;function Na(){var a=10*p(Oa)+45,b=a/180*ja;radY=(a/180+.5)*ja;xa=y(ka(b),.6*p(b),p(b));ya=y(ka(radY),.6*p(radY),p(radY));za=y(0,-.6,2)}function Pa(){for(var a=0;a<D.length;a++)D[a].ca();D.sort(Qa);for(a=0;a<D.length;a++)D[a].U()}
function Qa(a,b){return a.depth<b.depth?1:a.depth>b.depth?-1:0}function F(a){worldPoint=z(a,A(Ba,-1));worldPoint=z(z(A(xa,worldPoint[0]),A(ya,worldPoint[1])),A(za,worldPoint[2]));worldPoint=z(worldPoint,Aa);worldPoint=A(worldPoint,1.6*Da*(1+1E-4*worldPoint[2]));return z(worldPoint,Ca)}
function Ra(a,b,g,l,q,e){q=void 0===q?y(1,1,1):q;e=void 0===e?0:e;var k={da:[a,b,g,l],depth:0,color:q,enable:!0,W:function(n,v,r,h,f){f=void 0===f?null:f;k.points=[n,v,r,h];if(null==f){n=k.points;v=y();for(r=0;r<n.length;r++)v=z(v,n[r]);n=A(v,1/parseFloat(n.length))}else n=f;k.position=n},setColor:function(n){k.color=n},ca:function(){if(k.enable){k.depth=-F(k.position)[2]+e;for(var n=0;n<k.da.length;n++)k.da[n]=F(k.points[n])}},U:function(){k.enable&&(J.fillStyle=Sa(k.color),Ta(k.da))}};k.W(a,b,g,
l);D.push(k);return k}function Ta(a){var b=a[0],g=x(a[1],b);g=pa([g[1],-g[0]]);b=x(b,a[2]);if(!(0<g[0]*b[0]+g[1]*b[1])){J.beginPath();b=a[3];J.moveTo(b[0],b[1]);for(b=0;4>b;b++)J.lineTo(a[b][0],a[b][1]);J.closePath();J.fill()}}function Sa(a){var b=na(255*w(a[0])),g=na(255*w(a[1]));a=na(255*w(a[2]));return Ua(b,g,a)}function Ua(a,b,g){function l(e){e=e.toString(16);return 1==e.length?"0"+e:e}var q=void 0===q?255:q;return"#"+l(a)+l(b)+l(g)+l(q)}var K=Array,Va=[y(-1,1),y(-1,-1),y(1,1),y(1,-1)];
function Wa(a,b,g,l){function q(f,d,m,c,t){t=void 0===t?null:t;d=e(d,m,c);return 0<=d&&d<f.length?f[d]:t}function e(f,d,m,c){return f*(void 0===m?1:m)+d*(void 0===c?1:c)}g=void 0===g?-1:g;l=void 0===l?0:l;var k=4*a,n={D:K(a*a),points:K(a*a*4),G:K(a*a),X:K(a*a),R:K(a*a),P:K(a*a),size:a,ea:function(f,d,m){var c=this.D;f=e(f,d,this.size);0<=f&&f<c.length&&(c[f]=m)},qa:function(f,d){return q(this.D,f,d,this.size,0)},setColor:function(f,d,m){var c=this.G;f=e(f,d,this.size);0<=f&&f<c.length&&(c[f]=m)},
pa:function(f,d){return q(this.G,f,d,this.size,y())},H:function(){for(var f=0;f<this.size;f++)for(var d=0;d<this.size;d++){var m=e(f,d,this.size);m=y((f-v)*b,(d-v)*b,this.D[m]);for(var c=0;4>c;c++){var t=e(2*f+Math.floor(c/2),2*d+c%2,k);this.points[t]=z(m,A(Va[c],r))}}for(f=0;f<this.size;f++)for(d=0;d<this.size;d++)m=e(f,d,this.size),this.X[m].W(this.points[e(2*f,2*d,k)],this.points[e(2*f+1,2*d,k)],this.points[e(2*f+1,2*d+1,k)],this.points[e(2*f,2*d+1,k)]),this.X[m].setColor(this.G[m]),this.X[m].enable=
0<=this.D[m],f<this.size-1&&(this.R[m].W(this.points[e(2*f+1,2*d,k)],this.points[e(2*f+2,2*d,k)],this.points[e(2*f+2,2*d+1,k)],this.points[e(2*f+1,2*d+1,k)]),c=e(f+1,d,this.size),this.D[m]>this.D[c]?(t=A(this.G[m],.8),this.R[m].enable=0<=this.D[m]):(t=A(this.G[c],.8),this.R[m].enable=0<=this.D[c]),this.R[m].setColor(t)),d<this.size-1&&(this.P[m].W(this.points[e(2*f+1,2*d,k)],this.points[e(2*f,2*d,k)],this.points[e(2*f,2*d+3,k)],this.points[e(2*f+1,2*d+3,k)]),c=e(f,d+1,this.size),this.D[m]>this.D[c]?
(t=A(this.G[m],.7),this.P[m].enable=0<=this.D[m]):(t=A(this.G[c],.7),this.P[m].enable=0<=this.D[c]),this.P[m].setColor(t))}},v=.5*(a-1),r=.5*b;for(L=0;L<n.size;L++)for(M=0;M<n.size;M++){a=e(L,M,n.size);n.D[a]=g;var h=y(1,1,1);n.X[a]=Ra(h,h,h,h,h,l);n.R[a]=Ra(h,h,h,h,h,l);n.P[a]=Ra(h,h,h,h,h,l);n.G[a]=h}n.H();return n}var N=Wa(85,10,-1E-5,-50),Xa=Wa(35,50,50);
for(L=0;35>L;L++)for(M=0;35>M;M++){var Ya=80*Math.random(),Q=y(L-17,M-17),Za=w(Math.sqrt(Q[0]*Q[0]+Q[1]*Q[1]+Q[2]*Q[2])/17*2.4-1);Ya*=Za;0<L&&0<M&&34>L&&34>M||(Ya=-1);Xa.ea(L,M,Ya);var $a=Xa,ab=$a.setColor,bb=L,cb=M,db=Ya/80,eb=w(.3+.1*db),fb=w(.5+.5*db),gb=w(.3+.1*db);ab.call($a,bb,cb,y(eb,fb,gb))}Xa.H();var R=[],S=null;
function hb(a,b,g,l){var q=[1,2,3],e=[15,20,999],k=y(1,1,1),n=y(.5,.5,.5),v=[[-1E-4,-1E-4,-1E-4,-1E-4,-1E-4,-1E-4,4,2,4,-1E-4,-1E-4,2,0,2,-1E-4,-1E-4,4,2,4,-1E-4,-1E-4,-1E-4,-1E-4,-1E-4,-1E-4],[-1E-4,4,2,4,-1E-4,4,2,2,2,4,2,2,5,2,2,4,2,2,2,4,-1E-4,4,2,4,-1E-4],[4,2,3,2,4,2,7,5,7,2,3,5,3,5,3,2,7,5,7,2,4,2,3,2,4]],r={A:[a,b],position:y(50*a,50*b),B:y(),L:y(),K:[10,10],F:void 0===g?-1:g,T:0,ga:null,target:null,level:void 0===l?0:l,C:10,max:100,V:1,O:0,fa:[],M:0,depth:0,J:null,ca:function(){this.B=F(this.position);
this.L=F(z(this.position,y(0,0,64)));var h=Math.abs(this.L[1]-this.B[1]);this.K=[1.2*h,h];this.depth=-this.B[2]-1E3},U:function(){J.fillStyle=Sa(ib(r.F));J.textAlign="center";J.fillText(r.C,r.L[0],r.L[1]);r.C>=e[r.level]&&J.fillText("^",r.L[0]+.5*this.K[0],r.L[1])},upgrade:function(){this.C>=e[r.level]&&(this.C-=e[r.level],this.level+=1,this.H())},update:function(h){this.V-=h;0>=this.V&&(this.V=1,0<=this.F&&r.C<r.max&&(this.C+=q[this.level]));if(0<this.O)this.O-=h;else if(0<this.C&&0<this.T){for(h=
3;0<h&&0<this.T&&0<this.C;)--this.C,--this.T,ub(this.A[0],this.A[1],this.F,this.ga,h-2),--h;this.O+=.3}else this.target=null},contains:function(h,f){return this.B[0]-this.K[0]<h&&this.B[1]-this.K[1]<f&&this.B[0]+this.K[0]>h&&this.B[1]+this.K[1]>f},attack:function(h){this.F==h?this.C+=1:0>=this.C?(this.F=h,this.H(),this.C=1):--this.C},ka:function(h){if(null!=h&&null!=h.J){this.target=h;this.T=this.C/2;var f=[];for(f.push(h);null!=h.J;)h=h.J,f.push(h);this.ga=f}},H:function(){var h=40+5*this.A[0],f=
40+5*this.A[1],d=v[this.level],m=6;m=void 0===m?1:m;for(var c=0;5>c;c++)for(var t=0;5>t;t++)N.ea(h+c,f+t,d[5*c+t]*m);h=40+5*this.A[0];f=40+5*this.A[1];d=ib(this.F);for(m=0;5>m;m++)for(c=0;5>c;c++)N.setColor(h+m,f+c,d);N.H()},la:function(h){var f=-1E-5,d=k;null!=this.J&&(d=n,f=0);h&&(f=0);h=39+5*this.A[0];for(var m=39+5*this.A[1],c=0;7>c;c++)for(var t=0;7>t;t++)if(0==c||0==t||6==c||6==t)N.ea(h+c,m+t,f),N.setColor(h+c,m+t,d)}};T.push(r);D.push(r);R.push(r);r.H()}
function vb(){R.forEach(function(a){return a.la(a==S)});N.H()}function ib(a){switch(a){case 0:return y(.2,.2,1);case 1:return y(1,.2,.2);case 2:return y(.2,1,.2);default:return y(.6,.6,.6)}}function wb(){var a=xb.$,b=a[0];a=a[1];for(var g=0;g<R.length;g++)if(R[g].contains(b,a))return R[g];return null}
function yb(){var a=S;R.forEach(function(l){l.M=99999;l.J=null});if(null!=a){var b=[];b.push(a);a.M=0;for(var g={};0<b.length;)g={I:g.I},g.I=b.pop(),g.I.fa.forEach(function(l){return function(q){var e=l.I.M+oa(x(l.I.A,q.A));q.M>e&&(q.M=e,q.J=l.I,q.F==a.F&&b.push(q))}}(g))}}var zb=[0,0];
function ub(a,b,g,l,q){var e={offset:void 0===q?0:q,ba:[0,0],A:[a,b],position:y(50*a,50*b),B:y(),ha:y(),ia:zb,N:0,F:g,target:null,path:[].concat(l instanceof Array?l:da(ca(l))),C:1,ca:function(){this.B=F(this.position);this.ha=F(z(this.position,y(0,0,5)));this.depth=-this.B[2]-500},U:function(){var k=Math.abs(this.B[2]-this.ha[2]),n=.2*k,v=.34*k,r=[z(this.B,y(0,n)),z(this.B,y(v,0)),z(this.B,y(v,-k)),z(this.B,y(0,-k))];k=[z(this.B,y(0,n)),z(this.B,y(0,-k)),z(this.B,y(-v,-k)),z(this.B,y(-v,0))];J.fillStyle=
Sa(A(ib(e.F),.95));Ta(r);J.fillStyle=Sa(A(ib(e.F),.85));Ta(k)},update:function(k){var n=e.ia;n=[n[0]*k,n[1]*k];var v=e.A;e.A=[v[0]+n[0],v[1]+n[1]];e.position=[50*(e.A[0]+e.ba[0]*e.offset*.2),50*(e.A[1]+e.ba[1]*e.offset*.2),2*p(30*this.N+this.offset)];e.N-=k;0>=e.N&&(0<e.path.length?(e.target=e.path.pop(),n=x(e.target.A,e.A),k=pa(n),e.ba=[-k[1],k[0]],n=oa(n),e.ia=[1*k[0],1*k[1]],e.N=n/1):(e.target.attack(e.F),k=T.indexOf(e),-1<k&&T.splice(k,1),k=D.indexOf(e),-1<k&&D.splice(k,1)))}};T.push(e);D.push(e)}
var Ab,Bb=0,Db=Cb(),Eb=1/30,ua=document,Fb=ua.getElementById("a"),J=Fb.getContext("2d"),U=1,V=1,Gb=ua.documentElement,Oa=0;Hb();var Ib=Fb.getBoundingClientRect(),T=[],Jb=[];hb(-6,0,0,2);hb(6,0,1,2);for(var L=-1;2>L;L++)for(var M=-1;2>M;M++)hb(3*L,3*M);for(var Kb=0;Kb<R.length;Kb++)for(var Lb=0;Lb<R.length;Lb++)Kb!=Lb&&6>oa(x(R[Kb].A,R[Lb].A))&&R[Kb].fa.push(R[Lb]);
var xb=function(a){for(var b={key:[200],Z:!1,aa:!1,Y:!1,ja:!1,$:[0,0],update:function(){this.aa=this.Z=!1}},g=0;200>g;g++)b.key[g]=!1;B("keydown",function(l){b.key[l.keyCode]=!0});B("keyup",function(l){b.key[l.keyCode]=!1});B("click",function(){});B("mousedown",function(l){0==l.button&&(b.Z=!0,b.Y=!0);2==l.button&&(b.aa=!0,b.Y=!0)});B("mouseup",function(l){0==l.button&&(b.Y=!1);2==l.button&&(b.ja=!1)});B("mousemove",function(l){b.$[0]=l.clientX-a.left;b.$[1]=l.clientY-a.top});return b}(Ib);T.push(xb);
function Cb(){var a=window.performance;return a&&a.now?a.now():(new Date).getTime()}function Mb(){J.fillStyle="#101010";J.fillRect(0,0,U,V);Pa();J.fillStyle="#333333";J.strokeStyle="#101010";Jb.forEach(function(a){return a.U(J)})}function Nb(){var a=Bb;xb.Z&&(S=wb(),yb(),vb());if(xb.aa){var b=wb();null!=S&&null!=b&&(S==b?S.upgrade():S.ka(b))}xb.key[32]&&console.log(D);T.forEach(function(g){return g.update(a)});Oa+=.1*a;Na()}var Ob=requestAnimationFrame;
function Pb(){Ab=Cb();Bb=Math.min(1,(Ab-Db)/1E3);Bb>Eb&&(Bb=Eb);Db=Ab;Nb();Mb();Ob(Pb);U==Gb.clientWidth&&V==Gb.clientHeight||Hb()}Ob(Pb);function Hb(){U=Gb.clientWidth;V=Gb.clientHeight;Fb.width=U;Fb.height=V;var a=24;V>U&&(a*=V/U);J.font=parseInt(a)+"pt Arial";a=U;var b=V;Ca=y(.5*a,.5*b);Da=Math.min(a,b)/1024};

</script>
</html>