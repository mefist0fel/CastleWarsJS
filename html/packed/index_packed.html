<html>
	<head>
		<title>Castles</title>
		<style type="text/css">
		body {
			display: block;
			background-color:0;
			width: 100%;
			height: 100%;
			margin: 0;
		}
		canvas {
			background-color:0;
			display: block;
			margin: 0px auto;
		}
		</style>
	</head>
	<body>
		<canvas id="a"></canvas>
	</body>
	<script type="text/javascript">
function ba(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}}function ca(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];if(b)return b.call(a);if("number"==typeof a.length)return{next:ba(a)};throw Error(String(a)+" is not an iterable or ArrayLike");}function da(a){for(var b,g=[];!(b=a.next()).done;)g.push(b.value);return g}var ea=Number.MAX_VALUE,ia=Number.MIN_VALUE,ja=Math.PI,ka=Math.cos,n=Math.sin,la=Math.min,ma=Math.max,na=Math.round;
function w(a){return ma(la(a,1),0)}function x(a,b){return[a[0]-b[0],a[1]-b[1]]}function oa(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function pa(a){var b=1/oa(a);Infinity==b&&(b=ea);-Infinity==b&&(b=ia);return[a[0]*b,a[1]*b]}function z(a,b,g){return[void 0===a?0:a,void 0===b?0:b,void 0===g?0:g]}function A(a,b){return[a[0]+b[0],a[1]+b[1],a[2]+b[2]]}function B(a,b){return[a[0]*b,a[1]*b,a[2]*b]}function C(a,b){ua.addEventListener(a,b,!1)}
function va(){this.pa=function(a){for(var b=0;24>b;b++)this[String.fromCharCode(97+b)]=a[b]||0;.01>this.c&&(this.c=.01);a=this.b+this.c+this.e;.18>a&&(a=.18/a,this.b*=a,this.c*=a,this.e*=a)}}
var wa=new function(){this.S=new va;var a,b,g,k,q,d,h,l,u,y,m,c;this.reset=function(){var e=this.S;k=100/(e.f*e.f+.001);q=100/(e.g*e.g+.001);d=1-e.h*e.h*e.h*.01;h=-e.i*e.i*e.i*1E-6;e.a||(m=.5-e.n/2,c=5E-5*-e.o);l=1+e.l*e.l*(0<e.l?-.9:10);u=0;y=1==e.m?0:(1-e.m)*(1-e.m)*2E4+32};this.ra=function(){this.reset();var e=this.S;a=e.b*e.b*1E5;b=e.c*e.c*1E5;g=e.e*e.e*1E5+12;return 3*((a+b+g)/3|0)};this.qa=function(e,p){var f=this.S,r=1!=f.s||f.v,v=f.v*f.v*.1,Fa=1+3E-4*f.w,I=f.s*f.s*f.s*.1,kb=1+1E-4*f.t,lb=
1!=f.s,mb=f.x*f.x,nb=f.g,Ga=f.q||f.r,ob=f.r*f.r*f.r*.2,Ha=f.q*f.q*(0>f.q?-1020:1020),Ia=f.p?((1-f.p)*(1-f.p)*2E4|0)+32:0,pb=f.d,Ja=f.j/2,qb=f.k*f.k*.01,qa=f.a,ra=a,rb=1/a,sb=1/b,tb=1/g;f=5/(1+f.u*f.u*20)*(.01+I);.8<f&&(f=.8);f=1-f;for(var sa=!1,Ka=0,W=0,X=0,La=0,fa=0,Y,Z=0,D,J=0,K,ta=0,t,Ma=0,Q,Na=0,ha=Array(1024),aa=Array(32),F=ha.length;F--;)ha[F]=0;for(F=aa.length;F--;)aa[F]=2*Math.random()-1;for(F=0;F<p;F++){if(sa)return F;Ia&&++Ma>=Ia&&(Ma=0,this.reset());y&&++u>=y&&(y=0,k*=l);d+=h;k*=d;k>q&&
(k=q,0<nb&&(sa=!0));D=k;0<Ja&&(Na+=qb,D*=1+Math.sin(Na)*Ja);D|=0;8>D&&(D=8);qa||(m+=c,0>m?m=0:.5<m&&(m=.5));if(++W>ra)switch(W=0,++Ka){case 1:ra=b;break;case 2:ra=g}switch(Ka){case 0:X=W*rb;break;case 1:X=1+2*(1-W*sb)*pb;break;case 2:X=1-W*tb;break;case 3:X=0,sa=!0}Ga&&(Ha+=ob,K=Ha|0,0>K?K=-K:1023<K&&(K=1023));r&&Fa&&(v*=Fa,1E-5>v?v=1E-5:.1<v&&(v=.1));Q=0;for(var ub=8;ub--;){J++;if(J>=D&&(J%=D,3==qa))for(Y=aa.length;Y--;)aa[Y]=2*Math.random()-1;switch(qa){case 0:t=J/D<m?.5:-.5;break;case 1:t=1-J/
D*2;break;case 2:t=J/D;t=6.28318531*(.5<t?t-1:t);t=1.27323954*t+.405284735*t*t*(0>t?1:-1);t=.225*((0>t?-1:1)*t*t-t)+t;break;case 3:t=aa[Math.abs(32*J/D|0)]}r&&(Y=Z,I*=kb,0>I?I=0:.1<I&&(I=.1),lb?(fa+=(t-Z)*I,fa*=f):(Z=t,fa=0),Z+=fa,La+=Z-Y,t=La*=1-v);Ga&&(ha[ta%1024]=t,t+=ha[(ta-K+1024)%1024],ta++);Q+=t}Q*=.125*X*mb;e[F]=1<=Q?32767:-1>=Q?-32768:32767*Q|0}return p}};
window.jsfxr=function(a){wa.S.pa(a);var b=wa.ra();a=new Uint8Array(4*((b+1)/2|0)+44);b=2*wa.qa(new Uint16Array(a.buffer,44),b);var g=new Uint32Array(a.buffer,0,44);g[0]=1179011410;g[1]=b+36;g[2]=1163280727;g[3]=544501094;g[4]=16;g[5]=65537;g[6]=44100;g[7]=88200;g[8]=1048578;g[9]=1635017060;g[10]=b;b+=44;g=0;for(var k="data:audio/wav;base64,";g<b;g+=3){var q=a[g]<<16|a[g+1]<<8|a[g+2];k+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[q>>18]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[q>>
12&63]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[q>>6&63]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[q&63]}return k};var E=[],xa=z(1,0,0),ya=z(0,1,0),za=z(0,0,1),Aa=z(0,0,-20),Ba=z(),Ca=null,Da=1;function Ea(){var a=10*n(Oa)+45,b=a/180*ja;radY=(a/180+.5)*ja;xa=z(ka(b),.6*n(b),n(b));ya=z(ka(radY),.6*n(radY),n(radY));za=z(0,-.6,2)}function Pa(){for(var a=0;a<E.length;a++)E[a].ea();E.sort(Qa);for(a=0;a<E.length;a++)E[a].U()}
function Qa(a,b){return a.depth<b.depth?1:a.depth>b.depth?-1:0}function G(a){worldPoint=A(a,B(Ba,-1));worldPoint=A(A(B(xa,worldPoint[0]),B(ya,worldPoint[1])),B(za,worldPoint[2]));worldPoint=A(worldPoint,Aa);worldPoint=B(worldPoint,1.6*Da*(1+1E-4*worldPoint[2]));return A(worldPoint,Ca)}
function Ra(a,b,g,k,q,d){q=void 0===q?z(1,1,1):q;d=void 0===d?0:d;var h={fa:[a,b,g,k],depth:0,color:q,enable:!0,W:function(l,u,y,m,c){c=void 0===c?null:c;h.points=[l,u,y,m];if(null==c){l=h.points;u=z();for(y=0;y<l.length;y++)u=A(u,l[y]);l=B(u,1/parseFloat(l.length))}else l=c;h.position=l},setColor:function(l){h.color=l},ea:function(){if(h.enable){h.depth=-G(h.position)[2]+d;for(var l=0;l<h.fa.length;l++)h.fa[l]=G(h.points[l])}},U:function(){h.enable&&(H.fillStyle=Sa(h.color),Ta(h.fa))}};h.W(a,b,g,
k);E.push(h);return h}function Ta(a){var b=a[0],g=x(a[1],b);g=pa([g[1],-g[0]]);b=x(b,a[2]);if(!(0<g[0]*b[0]+g[1]*b[1])){H.beginPath();b=a[3];H.moveTo(b[0],b[1]);for(b=0;4>b;b++)H.lineTo(a[b][0],a[b][1]);H.closePath();H.fill()}}function Sa(a){var b=na(255*w(a[0])),g=na(255*w(a[1]));a=na(255*w(a[2]));return Ua(b,g,a)}function Ua(a,b,g){function k(d){d=d.toString(16);return 1==d.length?"0"+d:d}var q=void 0===q?255:q;return"#"+k(a)+k(b)+k(g)+k(q)}var L=Array,Va=[z(-1,1),z(-1,-1),z(1,1),z(1,-1)];
function Wa(a,b,g,k){function q(c,e,p,f,r){r=void 0===r?null:r;e=d(e,p,f);return 0<=e&&e<c.length?c[e]:r}function d(c,e,p,f){return c*(void 0===p?1:p)+e*(void 0===f?1:f)}g=void 0===g?-1:g;k=void 0===k?0:k;var h=4*a,l={F:L(a*a),points:L(a*a*4),G:L(a*a),X:L(a*a),R:L(a*a),P:L(a*a),size:a,ga:function(c,e,p){var f=this.F;c=d(c,e,this.size);0<=c&&c<f.length&&(f[c]=p)},ta:function(c,e){return q(this.F,c,e,this.size,0)},setColor:function(c,e,p){var f=this.G;c=d(c,e,this.size);0<=c&&c<f.length&&(f[c]=p)},
sa:function(c,e){return q(this.G,c,e,this.size,z())},I:function(){for(var c=0;c<this.size;c++)for(var e=0;e<this.size;e++){var p=d(c,e,this.size);p=z((c-u)*b,(e-u)*b,this.F[p]);for(var f=0;4>f;f++){var r=d(2*c+Math.floor(f/2),2*e+f%2,h);this.points[r]=A(p,B(Va[f],y))}}for(c=0;c<this.size;c++)for(e=0;e<this.size;e++)p=d(c,e,this.size),this.X[p].W(this.points[d(2*c,2*e,h)],this.points[d(2*c+1,2*e,h)],this.points[d(2*c+1,2*e+1,h)],this.points[d(2*c,2*e+1,h)]),this.X[p].setColor(this.G[p]),this.X[p].enable=
0<=this.F[p],c<this.size-1&&(this.R[p].W(this.points[d(2*c+1,2*e,h)],this.points[d(2*c+2,2*e,h)],this.points[d(2*c+2,2*e+1,h)],this.points[d(2*c+1,2*e+1,h)]),f=d(c+1,e,this.size),this.F[p]>this.F[f]?(r=B(this.G[p],.8),this.R[p].enable=0<=this.F[p]):(r=B(this.G[f],.8),this.R[p].enable=0<=this.F[f]),this.R[p].setColor(r)),e<this.size-1&&(this.P[p].W(this.points[d(2*c+1,2*e,h)],this.points[d(2*c,2*e,h)],this.points[d(2*c,2*e+3,h)],this.points[d(2*c+1,2*e+3,h)]),f=d(c,e+1,this.size),this.F[p]>this.F[f]?
(r=B(this.G[p],.7),this.P[p].enable=0<=this.F[p]):(r=B(this.G[f],.7),this.P[p].enable=0<=this.F[f]),this.P[p].setColor(r))}},u=.5*(a-1),y=.5*b;for(M=0;M<l.size;M++)for(N=0;N<l.size;N++){a=d(M,N,l.size);l.F[a]=g;var m=z(1,1,1);l.X[a]=Ra(m,m,m,m,m,k);l.R[a]=Ra(m,m,m,m,m,k);l.P[a]=Ra(m,m,m,m,m,k);l.G[a]=m}l.I();return l}var O=Wa(85,10,-1E-5,-50),Xa=Wa(35,50,50);
for(M=0;35>M;M++)for(N=0;35>N;N++){var Ya=80*Math.random(),P=z(M-17,N-17),Za=w(Math.sqrt(P[0]*P[0]+P[1]*P[1]+P[2]*P[2])/17*2.4-1);Ya*=Za;0<M&&0<N&&34>M&&34>N||(Ya=-1);Xa.ga(M,N,Ya);var $a=Xa,ab=$a.setColor,bb=M,cb=N,db=Ya/80,eb=w(.3+.1*db),fb=w(.5+.5*db),gb=w(.3+.1*db);ab.call($a,bb,cb,z(eb,fb,gb))}Xa.I();var R=[],S=null;
function hb(a,b,g,k){var q=[1,2,3],d=[15,20,999],h=[50,80,100],l=z(1,1,1),u=z(.5,.5,.5),y=[[-1E-4,-1E-4,-1E-4,-1E-4,-1E-4,-1E-4,4,2,4,-1E-4,-1E-4,2,0,2,-1E-4,-1E-4,4,2,4,-1E-4,-1E-4,-1E-4,-1E-4,-1E-4,-1E-4],[-1E-4,4,2,4,-1E-4,4,2,2,2,4,2,2,5,2,2,4,2,2,2,4,-1E-4,4,2,4,-1E-4],[4,2,3,2,4,2,7,5,7,2,3,5,3,5,3,2,7,5,7,2,4,2,3,2,4]],m={A:[a,b],position:z(50*a,50*b),C:z(),L:z(),K:[10,10],D:void 0===g?-1:g,T:0,ja:null,target:null,level:void 0===k?0:k,B:10,V:1,O:0,ia:[],M:0,depth:0,H:null,ea:function(){this.C=
G(this.position);this.L=G(A(this.position,z(0,0,64)));var c=Math.abs(this.L[1]-this.C[1]);this.K=[1.2*c,c];this.depth=-this.C[2]-1E3},U:function(){H.fillStyle=Sa(ib(m.D));H.textAlign="center";H.fillText(m.B,m.L[0],m.L[1]);m.B>=d[m.level]&&H.fillText("^",m.L[0]+.5*this.K[0],m.L[1])},upgrade:function(){this.B>=d[m.level]&&(this.B-=d[m.level],this.level+=1,this.I())},update:function(c){this.V-=c;0>=this.V&&(this.V=1,0<=this.D&&m.B<h[m.level]&&(this.B+=q[this.level]));if(0<this.O)this.O-=c;else if(0<
this.B&&0<this.T){for(c=3;0<c&&0<this.T&&0<this.B;)--this.B,--this.T,jb(this.A[0],this.A[1],this.D,this.ja,c-2),--c;this.O+=.3}else this.target=null},contains:function(c,e){return this.C[0]-this.K[0]<c&&this.C[1]-this.K[1]<e&&this.C[0]+this.K[0]>c&&this.C[1]+this.K[1]>e},attack:function(c){this.D==c?this.B+=1:0>=this.B?(this.D=c,this.I(),this.B=1):--this.B},la:function(c){if(null!=c&&null!=c.H){this.target=c;this.T=this.B/2;var e=[];for(e.push(c);null!=c.H;)c=c.H,e.push(c);this.ja=e}},I:function(){var c=
40+5*this.A[0],e=40+5*this.A[1],p=y[this.level],f=6;f=void 0===f?1:f;for(var r=0;5>r;r++)for(var v=0;5>v;v++)O.ga(c+r,e+v,p[5*r+v]*f);c=40+5*this.A[0];e=40+5*this.A[1];p=ib(this.D);for(f=0;5>f;f++)for(r=0;5>r;r++)O.setColor(c+f,e+r,p);O.I()},oa:function(c){var e=-1E-5,p=l;null!=this.H&&(p=u,e=0);c&&(e=0);c=39+5*this.A[0];for(var f=39+5*this.A[1],r=0;7>r;r++)for(var v=0;7>v;v++)if(0==r||0==v||6==r||6==v)O.ga(c+r,f+v,e),O.setColor(c+r,f+v,p)}};T.push(m);E.push(m);R.push(m);m.I()}
function vb(){R.forEach(function(a){return a.oa(a==S)});O.I()}function ib(a){switch(a){case 0:return z(.2,.2,1);case 1:return z(1,.2,.2);case 2:return z(.2,1,.2);default:return z(.6,.6,.6)}}function wb(){var a=xb.ba,b=a[0];a=a[1];for(var g=0;g<R.length;g++)if(R[g].contains(b,a))return R[g];return null}
function yb(a){R.forEach(function(k){k.M=99999;k.H=null});if(null!=a){var b=[];b.push(a);a.M=0;for(var g={};0<b.length;)g={J:g.J},g.J=b.pop(),g.J.ia.forEach(function(k){return function(q){var d=k.J.M+oa(x(k.J.A,q.A));q.M>d&&(q.M=d,q.H=k.J,q.D==a.D&&b.push(q))}}(g))}}var zb=[0,0];
function jb(a,b,g,k,q){var d={offset:void 0===q?0:q,da:[0,0],A:[a,b],position:z(50*a,50*b),C:z(),ka:z(),ma:zb,N:0,Z:g,target:null,path:[].concat(k instanceof Array?k:da(ca(k))),B:1,ea:function(){this.C=G(this.position);this.ka=G(A(this.position,z(0,0,5)));this.depth=-this.C[2]-500},U:function(){var h=Math.abs(this.C[2]-this.ka[2]),l=.2*h,u=.34*h,y=[A(this.C,z(0,l)),A(this.C,z(u,0)),A(this.C,z(u,-h)),A(this.C,z(0,-h))];h=[A(this.C,z(0,l)),A(this.C,z(0,-h)),A(this.C,z(-u,-h)),A(this.C,z(-u,0))];H.fillStyle=
Sa(B(ib(d.Z),.95));Ta(y);H.fillStyle=Sa(B(ib(d.Z),.85));Ta(h)},update:function(h){var l=d.ma;l=[l[0]*h,l[1]*h];var u=d.A;d.A=[u[0]+l[0],u[1]+l[1]];d.position=[50*(d.A[0]+d.da[0]*d.offset*.2),50*(d.A[1]+d.da[1]*d.offset*.2),2*n(30*this.N+this.offset)];d.N-=h;0>=d.N&&(0<d.path.length?(d.target=d.path.pop(),l=x(d.target.A,d.A),h=pa(l),d.da=[-h[1],h[0]],l=oa(l),d.ma=[1*h[0],1*h[1]],d.N=l/1):(d.target.attack(d.Z),h=T.indexOf(d),-1<h&&T.splice(h,1),h=E.indexOf(d),-1<h&&E.splice(h,1)))}};T.push(d);E.push(d)}
var Ab,Bb=0,Db=Cb(),Eb=1/30,ua=document,Fb=ua.getElementById("a"),H=Fb.getContext("2d"),U=1,V=1,Gb=ua.documentElement,Oa=0;Hb();var Ib=Fb.getBoundingClientRect(),T=[],Jb=[];hb(-6,0,0,2);hb(6,0,1,2);for(var M=-1;2>M;M++)for(var N=-1;2>N;N++)hb(3*M,3*N);for(var Kb=0;Kb<R.length;Kb++)for(var Lb=0;Lb<R.length;Lb++)Kb!=Lb&&6>oa(x(R[Kb].A,R[Lb].A))&&R[Kb].ia.push(R[Lb]);
var xb=function(a){for(var b={key:[200],aa:!1,ca:!1,$:!1,na:!1,ba:[0,0],update:function(){this.ca=this.aa=!1}},g=0;200>g;g++)b.key[g]=!1;C("keydown",function(k){b.key[k.keyCode]=!0});C("keyup",function(k){b.key[k.keyCode]=!1});C("click",function(){});C("mousedown",function(k){0==k.button&&(b.aa=!0,b.$=!0);2==k.button&&(b.ca=!0,b.$=!0)});C("mouseup",function(k){0==k.button&&(b.$=!1);2==k.button&&(b.na=!1)});C("mousemove",function(k){b.ba[0]=k.clientX-a.left;b.ba[1]=k.clientY-a.top});return b}(Ib);
T.push(xb);
(function(a,b,g){g=void 0===g?1:g;b={enable:!0,D:void 0===b?1:b,Y:.5,threshold:20,update:function(k){var q=this;this.Y-=k;0>this.Y&&(this.Y=.5+Math.random()*g,a.forEach(function(d){d.D==q.D&&(d.B>q.threshold&&(3<d.level&&q.ha(d),.3>Math.random()?d.upgrade():q.ha(d)),q.threshold=20+Math.random(15))}))},ha:function(k){var q=this;yb(k);var d=[];a.forEach(function(h){h!=k&&null!=h.H&&h.D!=q.D&&d.push(h)});0==d.length&&a.forEach(function(h){h!=k&&null!=h.H&&h.D==q.D&&d.push(h)});0<d.length&&k.la(d[Math.floor(Math.random()*
d.length)])}};T.push(b);return b})(R);function Cb(){var a=window.performance;return a&&a.now?a.now():(new Date).getTime()}function Mb(){H.fillStyle="#101010";H.fillRect(0,0,U,V);Pa();H.fillStyle="#333333";H.strokeStyle="#101010";Jb.forEach(function(a){return a.U(H)})}function Nb(){var a=Bb;xb.aa&&(S=wb(),yb(S),vb());if(xb.ca){var b=wb();null!=S&&null!=b&&(S==b?S.upgrade():(yb(S),S.la(b)))}xb.key[32]&&console.log(E);T.forEach(function(g){return g.update(a)});Oa+=.1*a;Ea()}var Ob=requestAnimationFrame;
function Pb(){Ab=Cb();Bb=Math.min(1,(Ab-Db)/1E3);Bb>Eb&&(Bb=Eb);Db=Ab;Nb();Mb();Ob(Pb);U==Gb.clientWidth&&V==Gb.clientHeight||Hb()}Ob(Pb);function Hb(){U=Gb.clientWidth;V=Gb.clientHeight;Fb.width=U;Fb.height=V;var a=24;V>U&&(a*=V/U);H.font=parseInt(a)+"pt Arial";a=U;var b=V;Ca=z(.5*a,.5*b);Da=Math.min(a,b)/1024};

</script>
</html>