<html>
	<head>
		<title>Castles</title>
		<style type="text/css">
		body {
			display: block;
			background-color:0;
			width: 100%;
			height: 100%;
			margin: 0;
		}
		canvas {
			background-color:0;
			display: block;
			margin: 0px auto;
		}
		</style>
	</head>
	<body>
		<canvas id="a"></canvas>
	</body>
	<script type="text/javascript">

const aa=Number.MAX_VALUE,ba=Number.MIN_VALUE,da=Math.PI,ea=Math.cos,fa=Math.sin,ha=Math.min,ia=Math.max,ja=Math.abs,ka=Math.round,la=Math.random,ma=Math.floor;function n(a){return ia(ha(a,1),0)}function sa(a,b){return[a[0]-b[0],a[1]-b[1]]}function ta(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function ua(a){var b=1/ta(a);Infinity==b&&(b=aa);-Infinity==b&&(b=ba);return[a[0]*b,a[1]*b]}function t(a=0,b=0,d=0){return[a,b,d]}function v(a,b){return[a[0]+b[0],a[1]+b[1],a[2]+b[2]]}
function w(a,b){return[a[0]*b,a[1]*b,a[2]*b]}function va(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2])};function y(a,b){wa.addEventListener(a,b,!1)};function za(){this.L=function(a){for(var b=0;24>b;b++)this[String.fromCharCode(97+b)]=a[b]||0;.01>this.c&&(this.c=.01);a=this.b+this.c+this.e;.18>a&&(a=.18/a,this.b*=a,this.c*=a,this.e*=a)}}
var Aa=new function(){this.L=new za;var a,b,d,c,h,g,p,m,u,x,q,f;this.ja=function(){var e=this.L;c=100/(e.f*e.f+.001);h=100/(e.g*e.g+.001);g=1-e.h*e.h*e.h*.01;p=-e.i*e.i*e.i*1E-6;e.a||(q=.5-e.n/2,f=5E-5*-e.o);m=1+e.l*e.l*(0<e.l?-.9:10);u=0;x=1==e.m?0:(1-e.m)*(1-e.m)*2E4+32};this.sa=function(){this.ja();var e=this.L;a=e.b*e.b*1E5;b=e.c*e.c*1E5;d=e.e*e.e*1E5+12;return 3*((a+b+d)/3|0)};this.ra=function(e,k){var l=this.L,z=1!=l.s||l.v,F=l.v*l.v*.1,N=1+3E-4*l.w,X=l.s*l.s*l.s*.1,Kb=1+1E-4*l.t,Lb=1!=l.s,
Mb=l.x*l.x,Nb=l.g,db=l.q||l.r,Ob=l.r*l.r*l.r*.2,eb=l.q*l.q*(0>l.q?-1020:1020),fb=l.p?((1-l.p)*(1-l.p)*2E4|0)+32:0,Pb=l.d,gb=l.j/2,Qb=l.k*l.k*.01,Ja=l.a,Ka=a,Rb=1/a,Sb=1/b,Tb=1/d;l=5/(1+l.u*l.u*20)*(.01+X);.8<l&&(l=.8);l=1-l;for(var La=!1,hb=0,na=0,oa=0,ib=0,xa=0,pa,qa=0,I,Y=0,Z,Ma=0,r,jb=0,ca,kb=0,ya=Array(1024),ra=Array(32),K=ya.length;K--;)ya[K]=0;for(K=ra.length;K--;)ra[K]=2*Math.random()-1;for(K=0;K<k;K++){if(La)return K;fb&&++jb>=fb&&(jb=0,this.ja());x&&++u>=x&&(x=0,c*=m);g+=p;c*=g;c>h&&(c=h,
0<Nb&&(La=!0));I=c;0<gb&&(kb+=Qb,I*=1+Math.sin(kb)*gb);I|=0;8>I&&(I=8);Ja||(q+=f,0>q?q=0:.5<q&&(q=.5));if(++na>Ka)switch(na=0,++hb){case 1:Ka=b;break;case 2:Ka=d}switch(hb){case 0:oa=na*Rb;break;case 1:oa=1+2*(1-na*Sb)*Pb;break;case 2:oa=1-na*Tb;break;case 3:oa=0,La=!0}db&&(eb+=Ob,Z=eb|0,0>Z?Z=-Z:1023<Z&&(Z=1023));z&&N&&(F*=N,1E-5>F?F=1E-5:.1<F&&(F=.1));ca=0;for(var Ub=8;Ub--;){Y++;if(Y>=I&&(Y%=I,3==Ja))for(pa=ra.length;pa--;)ra[pa]=2*Math.random()-1;switch(Ja){case 0:r=Y/I<q?.5:-.5;break;case 1:r=
1-Y/I*2;break;case 2:r=Y/I;r=6.28318531*(.5<r?r-1:r);r=1.27323954*r+.405284735*r*r*(0>r?1:-1);r=.225*((0>r?-1:1)*r*r-r)+r;break;case 3:r=ra[Math.abs(32*Y/I|0)]}z&&(pa=qa,X*=Kb,0>X?X=0:.1<X&&(X=.1),Lb?(xa+=(r-qa)*X,xa*=l):(qa=r,xa=0),qa+=xa,ib+=qa-pa,r=ib*=1-F);db&&(ya[Ma%1024]=r,r+=ya[(Ma-Z+1024)%1024],Ma++);ca+=r}ca*=.125*oa*Mb;e[K]=1<=ca?32767:-1>=ca?-32768:32767*ca|0}return k}};
window.jsfxr=function(a){Aa.L.L(a);var b=Aa.sa();a=new Uint8Array(4*((b+1)/2|0)+44);b=2*Aa.ra(new Uint16Array(a.buffer,44),b);var d=new Uint32Array(a.buffer,0,44);d[0]=1179011410;d[1]=b+36;d[2]=1163280727;d[3]=544501094;d[4]=16;d[5]=65537;d[6]=44100;d[7]=88200;d[8]=1048578;d[9]=1635017060;d[10]=b;b+=44;d=0;for(var c="data:audio/wav;base64,";d<b;d+=3){var h=a[d]<<16|a[d+1]<<8|a[d+2];c+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[h>>18]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[h>>
12&63]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[h>>6&63]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[h&63]}return c};var A=[],Ba=t(1,0,0),Ca=t(0,1,0),Da=t(0,0,1),Ea=t(0,0,-20),Fa=t(),Ga=null,Ha=1.6,Ia=1;function Na(){var a=Oa;let b=a/180*da;a=(a/180+.5)*da;Ba=t(ea(b),.6*fa(b),fa(b));Ca=t(ea(a),.6*fa(a),fa(a));Da=t(0,-.6,2)}function Pa(a,b){return a.depth<b.depth?1:a.depth>b.depth?-1:0}function Qa(a){a=v(a,w(Fa,-1));a=v(v(w(Ba,a[0]),w(Ca,a[1])),w(Da,a[2]));a=v(a,Ea);a=w(a,Ha*Ia*(1+1E-4*a[2]));return v(a,Ga)}
function Ra(a,b,d,c,h=t(1,1,1),g=0){var p={ga:[a,b,d,c],depth:0,color:h,enable:!0,Y(m,u,x,q,f=null){this.points=[m,u,x,q];if(null==f){m=p.points;u=t();for(x=0;x<m.length;x++)u=v(u,m[x]);m=w(u,1/parseFloat(m.length))}else m=f;this.position=m;this.position[2]=0},setColor(m){p.color=m},fa(){if(p.enable){p.depth=-Qa(p.position)[2]+g;for(let m=0;m<p.ga.length;m++)p.ga[m]=Qa(p.points[m])}},aa(){p.enable&&(B.fillStyle=Sa(p.color),Ta(p.ga))}};p.Y(a,b,d,c);A.push(p);return p}
function Ta(a){var b=a[0],d=sa(a[1],b);d=ua([d[1],-d[0]]);b=sa(b,a[2]);if(!(0<d[0]*b[0]+d[1]*b[1])){B.beginPath();b=a[3];B.moveTo(b[0],b[1]);for(b=0;4>b;b++)B.lineTo(a[b][0],a[b][1]);B.closePath();B.fill()}}function Sa(a){let b=ka(255*n(a[0])),d=ka(255*n(a[1]));a=ka(255*n(a[2]));return Ua(b,d,a)}function Ua(a,b,d){function c(h){h=h.toString(16);return 1==h.length?"0"+h:h}return"#"+c(a)+c(b)+c(d)+c(255)};let Va=1,Wa=[];for(var C=0;1E4>C;C++)Va=16807*Va%2147483647,Wa.push(la(Va/2147483647));function D(a,b,d,c=1E3){a=a*d+c;c=b*d+1E3;b=ma(a);d=ma(c);a-=b;c-=d;return(Wa[b%100*100+d%100]*(1-a)+Wa[(b+1)%100*100+d%100]*a)*(1-c)+(Wa[b%100*100+(d+1)%100]*(1-a)+Wa[(b+1)%100*100+(d+1)%100]*a)*c};let E=Array,Xa=[];const Ya=[t(-1,1),t(-1,-1),t(1,1),t(1,-1)];
function Za(a,b,d=-1,c=0){function h(f,e,k,l,z=null){e=g(e,k,l);return 0<=e&&e<f.length?f[e]:z}function g(f,e,k=1,l=1){return f*k+e*l}function p(f,e,k){f>e?(f-=k,f<e&&(f=e)):(f+=k,f>e&&(f=e));return f}let m=4*a;d={G:E(a*a),K:E(a*a),points:E(a*a*4),F:E(a*a),H:E(a*a),Z:E(a*a),T:E(a*a),S:E(a*a),size:a,threshold:d,ha(f,e,k){var l=this.K;f=g(f,e,this.size);0<=f&&f<l.length&&(l[f]=k)},wa(f,e){return h(this.K,f,e,this.size,0)},setColor(f,e,k){var l=this.H;f=g(f,e,this.size);0<=f&&f<l.length&&(l[f]=k)},va(f,
e){return h(this.H,f,e,this.size,t())},update(f){let e=!1;for(var k=0;k<this.K.length;k++)this.G[k]!=this.K[k]&&(this.G[k]=p(this.G[k],this.K[k],50*f),e=!0);for(k=0;k<this.H.length;k++)if(this.F[k][0]!=this.H[k][0]||this.F[k][1]!=this.H[k][1]||this.F[k][2]!=this.H[k][2])e=!0,this.F[k][0]=p(this.F[k][0],this.H[k][0],2*f),this.F[k][1]=p(this.F[k][1],this.H[k][1],2*f),this.F[k][2]=p(this.F[k][2],this.H[k][2],2*f);e&&this.I()},I(){for(var f=0;f<this.size;f++)for(var e=0;e<this.size;e++){var k=g(f,e,this.size);
k=t((f-u)*b,(e-u)*b,this.G[k]);for(var l=0;4>l;l++){var z=g(2*f+Math.floor(l/2),2*e+l%2,m);this.points[z]=v(k,w(Ya[l],x))}}for(f=0;f<this.size;f++)for(e=0;e<this.size;e++)k=g(f,e,this.size),this.Z[k].Y(this.points[g(2*f,2*e,m)],this.points[g(2*f+1,2*e,m)],this.points[g(2*f+1,2*e+1,m)],this.points[g(2*f,2*e+1,m)]),this.Z[k].setColor(this.F[k]),this.Z[k].enable=this.G[k]>=this.threshold,f<this.size-1&&(this.T[k].Y(this.points[g(2*f+1,2*e,m)],this.points[g(2*f+2,2*e,m)],this.points[g(2*f+2,2*e+1,m)],
this.points[g(2*f+1,2*e+1,m)]),l=g(f+1,e,this.size),this.G[k]>this.G[l]?(z=w(this.F[k],.8),this.T[k].enable=this.G[k]>=this.threshold):(z=w(this.F[l],.8),this.T[k].enable=this.G[l]>=this.threshold),this.T[k].setColor(z)),e<this.size-1&&(this.S[k].Y(this.points[g(2*f+1,2*e,m)],this.points[g(2*f,2*e,m)],this.points[g(2*f,2*e+3,m)],this.points[g(2*f+1,2*e+3,m)]),l=g(f,e+1,this.size),this.G[k]>this.G[l]?(z=w(this.F[k],.7),this.S[k].enable=this.G[k]>=this.threshold):(z=w(this.F[l],.7),this.S[k].enable=
this.G[l]>=this.threshold),this.S[k].setColor(z))},clear(f=0){for(var e=0;e<this.size;e++)for(var k=0;k<this.size;k++){let l=g(e,k,this.size);this.K[l]=f}this.I()}};let u=.5*(a-1),x=.5*b;for(a=0;a<d.size;a++)for(var q=0;q<d.size;q++){let f=g(a,q,d.size);d.G[f]=d.threshold;d.K[f]=d.threshold;let e=t(1,1,1);d.Z[f]=Ra(e,e,e,e,e,c);d.T[f]=Ra(e,e,e,e,e,c);d.S[f]=Ra(e,e,e,e,e,c);d.H[f]=e;d.F[f]=t(0,0,0)}d.I();Xa.push(d);return d}
function $a(a){let b=n(.3+.1*a),d=n(.5+.5*a);a=n(.3+.1*a);return t(b,d,a)}function G(a,b,d){for(var c=ab,h=0;5>h;h++)for(var g=0;5>g;g++)c.ha(a+h,b+g,6*d[5*h+g])}function bb(a,b,d,c){for(var h=ab,g=0;g<d;g++)for(var p=0;p<d;p++)h.setColor(a+g,b+p,c)}var ab=Za(85,10,0,-50),cb=Za(35,50,-100);function lb(a,b){for(var d=0;35>d;d++)for(var c=0;35>c;c++){let h=a(d,c),g=n(va(t(d-17,c-17))/17*2.4-1);h*=g;0<d&&0<c&&34>d&&34>c||(h=-100.01);cb.ha(d,c,h);cb.setColor(d,c,b(d,c))}}
function H(a,b){return n(va(t(a-17,b-17))/17*2.4-1)}cb.I();
function mb(a){for(C=0;C<nb.length;C++)J(L,nb[C]),J(A,nb[C]);nb=[];for(C=0;C<M.length;C++)J(L,M[C]),J(A,M[C]);M=[];ab.clear(-1E-5);ob.enable=!0;switch(a){case -1:a=[7,6,7,6,7,6,6,6,6,6,7,6,2,6,7,6,6,6,6,6,7,6,7,6,7];var b=[-1E-4,4,3,4,-1E-4,-1E-4,3,3,3,-1E-4,-1E-4,4,3,4,-1E-4,-1E-4,3,3,3,-1E-4,-1E-4,4,3,4,-1E-4];const d=[-1E-4,-1E-4,-1E-4,-1E-4,-1E-4,4,3,4,3,4,3,3,3,3,3,4,3,4,3,4,-1E-4,-1E-4,-1E-4,-1E-4,-1E-4];G(33,33,a);G(33,47,a);G(47,47,a);G(47,33,a);G(40,40,[15,12,15,12,15,12,12,12,12,12,15,12,
12,12,15,12,12,12,12,12,15,12,15,12,15]);G(38,33,b);G(42,33,b);G(38,47,b);G(42,47,b);G(33,38,d);G(33,42,d);G(47,38,d);G(47,42,d);bb(30,30,25,pb(0));lb((c,h)=>80*D(c,h,.3)*H(c,h),(c,h)=>$a(D(c,h,.3)*H(c,h)));break;case 0:O(3,3,0,1);O(-3,-3,1,1);O(1,-1);O(-1,1);qb();ob.enable=!1;lb((c,h)=>80*D(c,h,.3,300)*H(c,h),(c,h)=>$a(D(c,h,.3,300)*H(c,h)));break;default:case 1:O(0,6,0,2);O(0,-6,1,2);for(a=-1;2>a;a++)for(b=-1;2>b;b++)O(3*a,3*b);qb();lb((c,h)=>80*D(c,h,.45)*H(c,h),(c,h)=>{var g=D(c,h,.45)*H(c,h);
c=n(.5+.5*g);h=n(.5+.5*g);g=n(.3+.1*g);return t(c,h,g)});break;case 2:O(3,3,0,1),O(-3,-3,1,1),O(0,0),O(-3,0),O(3,0),O(0,-3),O(0,3),qb(),lb((c,h)=>80*D(c,h,.35,300)*H(c,h),(c,h)=>{var g=D(c,h,.35,300)*H(c,h);c=n(.5+.9*g);h=n(.5+.9*g);g=n(.7+1.5*g);return t(c,h,g)})}};var M=[],P=null;
function O(a,b,d=-1,c=0){const h=[1,2,3],g=[15,20,999],p=[50,80,100],m=t(1,1,1),u=t(.5,.5,.5),x=[[-1E-4,-1E-4,-1E-4,-1E-4,-1E-4,-1E-4,4,2,4,-1E-4,-1E-4,2,0,2,-1E-4,-1E-4,4,2,4,-1E-4,-1E-4,-1E-4,-1E-4,-1E-4,-1E-4],[-1E-4,4,2,4,-1E-4,4,2,2,2,4,2,2,5,2,2,4,2,2,2,4,-1E-4,4,2,4,-1E-4],[4,2,3,2,4,2,7,5,7,2,3,5,3,5,3,2,7,5,7,2,4,2,3,2,4]];var q={A:[a,b],position:t(50*a,50*b),C:t(),N:t(),M:[10,10],D:d,U:0,na:null,target:null,level:c,B:10,X:1,R:0,ma:[],O:0,depth:0,J:null,fa(){this.C=Qa(this.position);this.N=
Qa(v(this.position,t(0,0,64)));let f=Math.abs(this.N[1]-this.C[1]);this.M=[1.2*f,f];this.depth=-this.C[2]-1E3},aa(){B.fillStyle=Sa(pb(q.D));B.fillText(q.B,q.N[0],q.N[1]);q.B>=g[q.level]&&B.fillText("^",q.N[0]+.5*this.M[0],q.N[1])},upgrade(){this.B>=g[q.level]&&(this.B-=g[q.level],this.level+=1,this.I())},update(f){this.X-=f;0>=this.X&&(this.X=1,0<=this.D&&q.B<p[q.level]&&(this.B+=h[this.level]));if(0<this.R)this.R-=f;else if(0<this.B&&0<this.U){for(f=3;0<f&&0<this.U&&0<this.B;)--this.B,--this.U,rb(this.A[0],
this.A[1],this.D,this.na,f-2),--f;this.R+=.3}else this.target=null},contains(f,e){return this.C[0]-this.M[0]<f&&this.C[1]-this.M[1]<e&&this.C[0]+this.M[0]>f&&this.C[1]+this.M[1]>e},attack(f){this.D==f?this.B+=1:0>=this.B?(this.D=f,this.I(),this.B=1):--this.B},pa(f){if(null!=f&&null!=f.J){this.target=f;this.U=this.B/2;var e=[];for(e.push(f);null!=f.J;)f=f.J,e.push(f);this.na=e}},I(){G(40+5*this.A[0],40+5*this.A[1],x[this.level]);bb(40+5*this.A[0],40+5*this.A[1],5,pb(this.D));ab.I()},ua(f){var e=-1E-5,
k=u;null!=this.J&&(e=0,k=u);f&&(e=0,k=m);f=39+5*this.A[0];for(var l=39+5*this.A[1],z=ab,F=0;7>F;F++)for(var N=0;7>N;N++)if(0==F||0==N||6==F||6==N)z.ha(f+F,l+N,e),z.setColor(f+F,l+N,k)},xa(){J(L,q);J(A,q);J(M,q)}};L.push(q);A.push(q);M.push(q);q.I()}function sb(){M.forEach(a=>a.ua(a==P));ab.I()}function pb(a){switch(a){case 0:return t(.2,.2,1);case 1:return t(1,.2,.2);case 2:return t(.2,1,.2);default:return t(.6,.6,.6)}}
function tb(){var a=Q.W;let b=a[0];a=a[1];for(var d=0;d<M.length;d++)if(M[d].contains(b,a))return M[d];return null}function qb(){for(var a=0;a<M.length;a++)for(var b=0;b<M.length;b++)a!=b&&6>ta(sa(M[a].A,M[b].A))&&M[a].ma.push(M[b])}function ub(a){M.forEach(d=>{d.O=99999;d.J=null});if(null!=a){var b=[];b.push(a);for(a.O=0;0<b.length;){let d=b.pop();d.ma.forEach(c=>{let h=d.O+ta(sa(d.A,c.A));c.O>h&&(c.O=h,c.J=d,c.D==a.D&&b.push(c))})}}};const vb=[0,0];var nb=[];
function rb(a,b,d,c,h=0){var g={offset:h,ea:[0,0],A:[a,b],position:t(50*a,50*b),C:t(),oa:t(),qa:vb,P:0,ba:d,scale:1,target:null,la:[a,b],ia:[a,b],path:[...c],B:1,fa(){this.C=Qa(this.position);this.oa=Qa(v(this.position,t(0,0,5)));this.depth=-this.C[2]-500},aa(){var p=Math.abs(this.C[2]-this.oa[2])*this.scale,m=.2*p,u=.34*p;let x=[v(this.C,t(0,m)),v(this.C,t(u,0)),v(this.C,t(u,-p)),v(this.C,t(0,-p))];p=[v(this.C,t(0,m)),v(this.C,t(0,-p)),v(this.C,t(-u,-p)),v(this.C,t(-u,0))];B.fillStyle=Sa(w(pb(g.ba),
.95));Ta(x);B.fillStyle=Sa(w(pb(g.ba),.85));Ta(p)},update(p){var m=g.qa;m=[m[0]*p,m[1]*p];var u=g.A;g.A=[u[0]+m[0],u[1]+m[1]];g.position=[50*(g.A[0]+g.ea[0]*g.offset*.2),50*(g.A[1]+g.ea[1]*g.offset*.2),2*fa(30*this.P+this.offset)];g.scale=n(ha(20*(wb(g.A,g.la)-.05),20*(wb(g.A,g.ia)-.05)));g.P-=p;0>=g.P&&(0<g.path.length?(g.target=g.path.pop(),g.la=g.ia,g.ia=g.target.A,m=sa(g.target.A,g.A),p=ua(m),g.ea=[-p[1],p[0]],m=ta(m),g.qa=[1*p[0],1*p[1]],g.P=m/1):(g.target.attack(g.ba),J(L,g),J(A,g),J(nb,g)))}};
L.push(g);A.push(g);nb.push(g)}function J(a,b){b=a.indexOf(b);-1<b&&a.splice(b,1)}function wb(a,b){return ha(ja(a[0]-b[0]),ja(a[1]-b[1]))};var xb,yb=0,Ab=zb(),Bb=1/30,wa=document,Cb=wa.getElementById("a"),B=Cb.getContext("2d"),R=1,S=1,Db=1,Eb=1,Fb=1,Gb=1,Hb=wa.documentElement,Ib=0,Oa=0,L=[];Jb();
var Q=function(a){for(var b={key:[200],V:!1,da:!1,ca:!1,ta:!1,W:[0,0],update(){this.da=this.V=!1}},d=0;200>d;d++)b.key[d]=!1;y("contextmenu",function(c){c.preventDefault()});y("keydown",function(c){b.key[c.keyCode]=!0});y("keyup",function(c){b.key[c.keyCode]=!1});y("click",function(){});y("mousedown",function(c){0==c.button&&(b.V=!0,b.ca=!0);2==c.button&&(b.da=!0,b.ca=!0)});y("mouseup",function(c){0==c.button&&(b.ca=!1);2==c.button&&(b.ta=!1)});y("mousemove",function(c){b.W[0]=c.clientX-a.left;b.W[1]=
c.clientY-a.top});return b}(Cb.getBoundingClientRect()),ob=function(a=1,b=1){a={enable:!0,D:a,$:.5,threshold:20,update(d){this.enable&&(this.$-=d,0>this.$&&(this.$=.5+la()*b,M.forEach(c=>{c.D==this.D&&(c.B>this.threshold&&(3<c.level&&this.ka(c),.3>la()?c.upgrade():this.ka(c)),this.threshold=20+la(15))})))},ka(d){ub(d);let c=[];M.forEach(h=>{h!=d&&null!=h.J&&h.D!=this.D&&c.push(h)});0==c.length&&M.forEach(h=>{h!=d&&null!=h.J&&h.D==this.D&&c.push(h)});0<c.length&&d.pa(c[Math.floor(la()*c.length)])}};
L.push(a);return a}(),T=0,Vb=null;Ha=.7;U(0);V();function Wb(){B.fillStyle="#101010";B.fillRect(0,0,R,S);for(var a=0;a<A.length;a++)A[a].fa();A.sort(Pa);for(a=0;a<A.length;a++)A[a].aa()}function U(a){0==a?(mb(-1),Vb=Xb):-1==a?(mb(T),Vb=Yb):-2==a?Vb=Zb:-3==a?Vb=$b:1==a&&(Vb=ac)}function bc(a){Ha=.02*a+.98*Ha}function cc(a){Oa+=8*a;360<Oa&&(Oa-=360);Na()}function dc(a){Ib+=.1*a;Oa=.9*Oa+.1*(10*fa(Ib)+65);Na()}
function Zb(a){bc(1.2);cc(a);Xa.forEach(b=>b.update(a));Wb();B.fillStyle="#66FF66";V(60);ec("WIN",-35);V();W("MENU",0,0,18)&&U(0);W("NEXT",0,20,18)&&(T+=1,U(-1));Q.key[27]&&U(0)}function $b(a){bc(1.2);cc(a);Xa.forEach(b=>b.update(a));Wb();B.fillStyle="#FF6666";V(60);ec("LOSE",-35);V();W("MENU",0,0,18)&&U(0);W("RESTART",0,20,18)&&U(-1);Q.key[27]&&U(0)}
function Xb(a){bc(1.2);cc(a);Xa.forEach(b=>b.update(a));Wb();B.fillStyle="#FFFFFF";V(60);ec("CASTLE WARS",-35);V();W("START",0,20,18)&&U(-1);Q.key[32]&&U(-1)}function Yb(a){bc(1.4);Xa.forEach(b=>b.update(a));dc(a);Wb();B.fillStyle="#FFFFFF";V(40);ec("SELECT LEVEL",-35);V(32);0<T?ec(T,-25):ec("TUTORIAL",-25);V();W("START",0,20,18)&&U(1);Q.key[32]&&U(1);Q.key[27]&&U(0);if(W(">>",16,20,9)||Q.key[39])T+=1,mb(T);if(0<T&&W("<<",-16,20,9)||Q.key[37])--T,mb(T)}
function ac(a){bc(1.6);Xa.forEach(c=>c.update(a));Q.key[27]&&U(0);Q.V&&(P=tb(),null!=P&&0!=P.D&&(P=null),ub(P),sb());if(Q.da){let c=tb();null!=P&&null!=c&&(P==c?P.upgrade():(ub(P),P.pa(c)))}let b=0,d=0;M.forEach(c=>{0==c.D&&(b+=1);1==c.D&&(d+=1)});0==b&&U(-3);0==d&&U(-2);L.forEach(c=>c.update(a));dc(a);Wb()}function zb(){let a=window.performance;return a&&a.now?a.now():(new Date).getTime()}let fc=requestAnimationFrame;
function gc(){xb=zb();yb=Math.min(1,(xb-Ab)/1E3);yb>Bb&&(yb=Bb);Ab=xb;Vb(yb);fc(gc);Q.update();R==Hb.clientWidth&&S==Hb.clientHeight||Jb()}fc(gc);function Jb(){R=Hb.clientWidth;S=Hb.clientHeight;Db=Math.min(R,S);Eb=.5*R;Fb=.5*S;Gb=.01*Db;Cb.width=R;Cb.height=S;var a=R,b=S;Ga=t(.5*a,.5*b);Ia=Math.min(a,b)/1024}function V(a=24){S>R&&(a*=S/R);B.font=parseInt(a)+"pt Arial";B.textAlign="center"}function ec(a,b){B.fillText(a,0*Gb+Eb,b*Gb+Fb)}
function W(a,b,d,c){c=c*Gb*.5;let h=3*Gb;b=b*Gb+Eb;d=d*Gb+Fb;B.fillStyle="#66666699";B.fillRect(b-c,d-h-12,2*c,2*h);B.fillStyle="#FFFFFF";B.fillText(a,b,d);return Q.V&&(a=Q.W,b-c<a[0]&&d-h<a[1]&&b+c>a[0]&&d+h>a[1])?(Q.update(1),!0):!1};


</script>
</html>